{
  User user=(User)request.getSession().getAttribute("user");
  if (user == null) {
    writeError("No user in session. Please authenticate first.",response);
  }
 else {
    UrlPathHelper helper=new UrlPathHelper();
    String path=helper.getLookupPathForRequest(request);
    List<Bookmark> bookmarks=new ArrayList<Bookmark>();
    try {
      boolean success=false;
      if (path.equals(BookmarkXmlController.BOOKMARK_API_RECENT)) {
        success=handleFindRecent(user,bookmarks);
      }
 else       if (path.equals(BookmarkXmlController.BOOKMARK_API_ALL)) {
        String tag=request.getParameter("tag");
        success=handleFindAll(tag,user,response,bookmarks);
      }
 else {
        writeError("API call [" + path + "] not supported.",response);
      }
      if (success) {
        response.setContentType("text/xml");
        XStream xs=createSerializer();
        xs.toXML(bookmarks,response.getWriter());
      }
    }
 catch (    Exception e) {
      LOG.error("Error invoking bookmark services: " + e.getMessage(),e);
      writeError("Bookmark service is currently unavailable. Please try again later",response);
    }
  }
  return null;
}
