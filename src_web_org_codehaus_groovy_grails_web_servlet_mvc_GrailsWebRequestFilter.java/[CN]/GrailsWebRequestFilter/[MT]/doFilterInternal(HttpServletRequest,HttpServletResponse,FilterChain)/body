{
  LocaleContextHolder.setLocale(request.getLocale());
  ServletRequestAttributes requestAttributes=new GrailsWebRequest(request,response,getServletContext());
  RequestContextHolder.setRequestAttributes(requestAttributes);
  if (logger.isDebugEnabled()) {
    logger.debug("Bound Grails request context to thread: " + request);
  }
  try {
    request.setAttribute(GrailsApplicationAttributes.WEB_REQUEST,requestAttributes);
    filterChain.doFilter(request,response);
  }
  finally {
    requestAttributes.requestCompleted();
    request.removeAttribute(GrailsApplicationAttributes.WEB_REQUEST);
    RequestContextHolder.setRequestAttributes(null);
    LocaleContextHolder.setLocale(null);
    if (logger.isDebugEnabled()) {
      logger.debug("Cleared Grails thread-bound request context: " + request);
    }
  }
}
