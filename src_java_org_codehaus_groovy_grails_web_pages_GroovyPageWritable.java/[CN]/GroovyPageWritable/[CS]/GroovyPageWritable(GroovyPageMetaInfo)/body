{
  webRequest=(GrailsWebRequest)RequestContextHolder.currentRequestAttributes();
  final ApplicationContext applicationContext=webRequest.getApplicationContext();
  if (applicationContext != null && applicationContext.containsBean(GrailsPluginManager.BEAN_NAME)) {
    pluginManager=applicationContext.getBean(GrailsPluginManager.BEAN_NAME,GrailsPluginManager.class);
  }
  request=webRequest.getCurrentRequest();
  HttpServletResponse wrapped=WrappedResponseHolder.getWrappedResponse();
  response=wrapped != null ? wrapped : webRequest.getCurrentResponse();
  context=webRequest.getServletContext();
  this.metaInfo=metaInfo;
  showSource=shouldShowGroovySource();
  debugTemplates=shouldDebugTemplates();
  if (debugTemplates) {
    debugTemplatesIdCounter=(AtomicInteger)request.getAttribute(ATTRIBUTE_NAME_DEBUG_TEMPLATES_ID_COUNTER);
    if (debugTemplatesIdCounter == null) {
      debugTemplatesIdCounter=new AtomicInteger(0);
      request.setAttribute(ATTRIBUTE_NAME_DEBUG_TEMPLATES_ID_COUNTER,debugTemplatesIdCounter);
    }
  }
}
