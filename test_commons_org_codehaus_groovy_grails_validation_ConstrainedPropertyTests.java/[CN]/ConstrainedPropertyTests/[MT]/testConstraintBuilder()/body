{
  GroovyClassLoader gcl=new GroovyClassLoader();
  Class groovyClass=gcl.parseClass("class TestClass {\n" + "@Property Long id\n" + "@Property Long version\n"+ "@Property String login\n"+ "@Property String email\n"+ "@Property constraints = {\n"+ "login(length:5..15,nullable:false,blank:false)\n"+ "email(email:true)\n"+ "}\n"+ "}");
  GrailsDomainClass domainClass=new DefaultGrailsDomainClass(groovyClass);
  Map constrainedProperties=domainClass.getConstrainedProperties();
  assertTrue(constrainedProperties.size() == 2);
  ConstrainedProperty loginConstraint=(ConstrainedProperty)constrainedProperties.get("login");
  assertTrue(loginConstraint.getAppliedConstraints().size() == 3);
  ConstrainedProperty emailConstraint=(ConstrainedProperty)constrainedProperties.get("email");
  assertTrue(emailConstraint.getAppliedConstraints().size() == 1);
  GroovyObject go=(GroovyObject)groovyClass.newInstance();
  go.setProperty("email","rubbish_email");
  Errors errors=new BindException(go,"TestClass");
  emailConstraint.validate(go,go.getProperty("email"),errors);
  assertTrue(errors.hasErrors());
  go.setProperty("email","valid@email.com");
  errors=new BindException(go,"TestClass");
  emailConstraint.validate(go,go.getProperty("email"),errors);
  assertFalse(errors.hasErrors());
}
