{
  outWriter=new GroovyPageProxyWriter(new DestinationFactory(){
    public Writer activateDestination() throws IOException {
      StackEntry stackEntry=stack.peek();
      return createEncodingWriter(stackEntry.unwrappedTarget,stackEntry.outEncoder,encodingStateRegistry,GroovyPageConfig.OUT_CODEC_NAME);
    }
  }
);
  staticWriter=new GroovyPageProxyWriter(new DestinationFactory(){
    public Writer activateDestination() throws IOException {
      StackEntry stackEntry=stack.peek();
      if (stackEntry.staticEncoder != null) {
        return createEncodingWriter(stackEntry.unwrappedTarget,stackEntry.staticEncoder,encodingStateRegistry,GroovyPageConfig.STATIC_CODEC_NAME);
      }
 else {
        return stackEntry.unwrappedTarget;
      }
    }
  }
);
  expressionWriter=new GroovyPageProxyWriter(new DestinationFactory(){
    public Writer activateDestination() throws IOException {
      StackEntry stackEntry=stack.peek();
      return createEncodingWriter(stackEntry.unwrappedTarget,stackEntry.expressionEncoder,encodingStateRegistry,GroovyPageConfig.EXPRESSION_CODEC_NAME);
    }
  }
);
  taglibWriter=new GroovyPageProxyWriter(new DestinationFactory(){
    public Writer activateDestination() throws IOException {
      StackEntry stackEntry=stack.peek();
      return createEncodingWriter(stackEntry.unwrappedTarget,stackEntry.taglibEncoder != null ? stackEntry.taglibEncoder : stackEntry.defaultTaglibEncoder,encodingStateRegistry,GroovyPageConfig.TAGLIB_CODEC_NAME);
    }
  }
);
  this.autoSync=attributes.isAutoSync();
  push(attributes,false);
  if (!autoSync) {
    applyWriterThreadLocals(outWriter);
  }
  this.encodingStateRegistry=attributes.getWebRequest().getEncodingStateRegistry();
}
