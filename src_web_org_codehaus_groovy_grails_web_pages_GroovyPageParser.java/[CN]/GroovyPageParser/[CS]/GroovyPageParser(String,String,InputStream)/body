{
  Map config=ConfigurationHolder.getFlatConfig();
  Object gspEnc=config.get(CONFIG_PROPERTY_GSP_ENCODING);
  if ((gspEnc != null) && (gspEnc.toString().trim().length() > 0)) {
    gspEncoding=gspEnc.toString();
  }
 else {
    gspEncoding=System.getProperty("file.encoding","us-ascii");
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("GSP file encoding set to: " + gspEncoding);
  }
  scan=new GroovyPageScanner(readStream(in));
  this.pageName=filename;
  this.environment=Environment.getCurrent();
  makeName(name);
  Object o=config.get(CONFIG_PROPERTY_DEFAULT_CODEC);
  lookupCodec(o);
  Object keepDirObj=config.get(CONFIG_PROPERTY_GSP_KEEPGENERATED_DIR);
  if (keepDirObj instanceof File) {
    keepGeneratedDirectory=((File)keepDirObj);
  }
 else   if (keepDirObj != null) {
    keepGeneratedDirectory=new File(String.valueOf(keepDirObj));
  }
  if (keepGeneratedDirectory != null && !keepGeneratedDirectory.isDirectory()) {
    LOG.warn("The directory specified with " + CONFIG_PROPERTY_GSP_KEEPGENERATED_DIR + " config parameter doesn't exist or isn't a readable directory. Absolute path: '"+ keepGeneratedDirectory.getAbsolutePath()+ "' Keepgenerated will be disabled.");
    keepGeneratedDirectory=null;
  }
}
