{
  ApplicationContext ctx=WebApplicationContextUtils.getRequiredWebApplicationContext(servletContext);
  GrailsApplication application=null;
  if (ctx.containsBean(GrailsApplication.APPLICATION_ID)) {
    application=(GrailsApplication)ctx.getBean(GrailsApplication.APPLICATION_ID);
  }
  if (application == null) {
    return ctx;
  }
  if (ctx.containsBean(GroovyPageResourceLoader.BEAN_ID) && !application.isWarDeployed()) {
    return (ResourceLoader)ctx.getBean(GroovyPageResourceLoader.BEAN_ID);
  }
  return ctx;
}
