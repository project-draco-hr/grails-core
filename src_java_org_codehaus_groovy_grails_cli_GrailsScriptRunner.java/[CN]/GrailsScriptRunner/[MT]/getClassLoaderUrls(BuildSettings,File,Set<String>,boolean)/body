{
  List<URL> urls=new ArrayList<URL>();
  if (settings.getGrailsHome() != null) {
    urls.add(cacheDir.toURI().toURL());
  }
  if (settings.getResourcesDir() != null && settings.getResourcesDir().exists()) {
    urls.add(settings.getResourcesDir().toURI().toURL());
  }
  final boolean dependenciesExternallyConfigured=settings.isDependenciesExternallyConfigured();
  long now=System.currentTimeMillis();
  final List<File> buildDependencies=settings.getBuildDependencies();
  if (!dependenciesExternallyConfigured && buildDependencies.isEmpty()) {
    exitWithError("Required Grails build dependencies were not found. Either GRAILS_HOME is not set or your dependencies are misconfigured in grails-app/conf/BuildConfig.groovy");
  }
  addDependenciesToURLs(excludes,urls,buildDependencies);
  addDependenciesToURLs(excludes,urls,settings.getProvidedDependencies());
  addDependenciesToURLs(excludes,urls,settings.getTestDependencies());
  if (!dependenciesExternallyConfigured) {
    System.out.println("Dependencies resolved in " + (System.currentTimeMillis() - now) + "ms.");
  }
  if (!skipPlugins) {
    for (    File dir : listKnownPluginDirs(settings)) {
      addPluginLibs(dir,urls,settings);
    }
  }
  return urls.toArray(new URL[urls.size()]);
}
