{
  System.setProperty("TomcatKillSwitch.active","true");
  int killListenerPort=serverPort + 1;
  ServerSocket serverSocket=createKillSwitch(killListenerPort);
  if (serverSocket != null) {
    try {
      serverSocket.accept();
      try {
        tomcat.stop();
        tomcat.destroy();
        System.setProperty(TOMCAT_KILL_SWITCH_ACTIVE,"false");
      }
 catch (      LifecycleException e) {
        System.err.println("Error stopping Tomcat: " + e.getMessage());
        System.exit(1);
      }
    }
 catch (    IOException e) {
    }
  }
}
