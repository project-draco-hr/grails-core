{
  Binding binding=(Binding)request.getAttribute(GrailsApplicationAttributes.PAGE_SCOPE);
  if (binding == null) {
    binding=new Binding();
    request.setAttribute(GrailsApplicationAttributes.PAGE_SCOPE,binding);
  }
  binding.setVariable(GroovyPage.PAGE_SCOPE,binding);
  GroovyObject controller=(GroovyObject)request.getAttribute(GrailsApplicationAttributes.CONTROLLER);
  if (controller != null) {
    try {
      formulateBindingFromController(binding,controller,out);
    }
 catch (    MissingPropertyException mpe) {
      formulateBindingFromWebRequest(binding,request,response,out);
    }
  }
 else {
    formulateBindingFromWebRequest(binding,request,response,out);
  }
  populateViewModel(request,binding);
  return binding;
}
