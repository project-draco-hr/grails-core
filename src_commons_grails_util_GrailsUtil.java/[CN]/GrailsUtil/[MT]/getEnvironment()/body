{
  GrailsApplication app=ApplicationHolder.getApplication();
  String envName=null;
  if (app != null) {
    envName=(String)app.getMetadata().get(GrailsApplication.ENVIRONMENT);
  }
  if (StringUtils.isBlank(envName))   envName=System.getProperty(GrailsApplication.ENVIRONMENT);
  if (StringUtils.isBlank(envName)) {
    return GrailsApplication.ENV_PRODUCTION;
  }
 else {
    if (envNameMappings.containsKey(envName)) {
      return (String)envNameMappings.get(envName);
    }
 else {
      return envName;
    }
  }
}
