{
  UrlMappingsHolder holder=WebUtils.lookupUrlMappings(getServletContext());
  GrailsWebRequest webRequest=(GrailsWebRequest)request.getAttribute(GrailsApplicationAttributes.WEB_REQUEST);
  List<String> excludePatterns=holder.getExcludePatterns();
  String uri=urlHelper.getPathWithinApplication(request);
  checkForCompilationErrors();
  GrailsClass[] controllers=application.getArtefacts(ControllerArtefactHandler.TYPE);
  if ((controllers == null || controllers.length == 0 || holder == null) && !"/".equals(uri)) {
    processFilterChain(request,response,filterChain);
    return;
  }
 else   if (excludePatterns != null && excludePatterns.size() > 0) {
    for (    String excludePattern : excludePatterns) {
      if (uri.equals(excludePattern) || (excludePattern.endsWith("*") && excludePattern.substring(0,excludePattern.length() - 1).regionMatches(0,uri,0,excludePattern.length() - 1))) {
        processFilterChain(request,response,filterChain);
        return;
      }
    }
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("Executing URL mapping filter...");
    LOG.debug(holder);
  }
  if (WebUtils.areFileExtensionsEnabled()) {
    String format=WebUtils.getFormatFromURI(uri);
    if (format != null) {
      MimeType[] configuredMimes=MimeType.getConfiguredMimeTypes();
      for (      MimeType configuredMime : configuredMimes) {
        if (configuredMime.getExtension().equals(format)) {
          request.setAttribute(GrailsApplicationAttributes.CONTENT_FORMAT,format);
          uri=uri.substring(0,(uri.length() - format.length() - 1));
          break;
        }
      }
    }
  }
  UrlMappingInfo[] urlInfos=holder.matchAll(uri);
  WrappedResponseHolder.setWrappedResponse(response);
  boolean dispatched=false;
  try {
    Map backupParameters;
    try {
      backupParameters=new HashMap(webRequest.getParams());
    }
 catch (    Exception e) {
      GrailsUtil.deepSanitize(e);
      LOG.error("Error creating params object: " + e.getMessage(),e);
      backupParameters=Collections.EMPTY_MAP;
    }
    for (    UrlMappingInfo info : urlInfos) {
      if (info != null) {
        webRequest.getParams().clear();
        webRequest.getParams().putAll(backupParameters);
        final String viewName;
        try {
          info.configure(webRequest);
          String action=info.getActionName() == null ? "" : info.getActionName();
          viewName=info.getViewName();
          if (viewName == null && info.getURI() == null) {
            final String controllerName=info.getControllerName();
            GrailsClass controller=application.getArtefactForFeature(ControllerArtefactHandler.TYPE,WebUtils.SLASH + controllerName + WebUtils.SLASH+ action);
            if (controller == null) {
              continue;
            }
          }
        }
 catch (        Exception e) {
          GrailsUtil.deepSanitize(e);
          if (e instanceof MultipartException) {
            throw ((MultipartException)e);
          }
          LOG.error("Error when matching URL mapping [" + info + "]:"+ e.getMessage(),e);
          continue;
        }
        dispatched=true;
        request=checkMultipart(request);
        if (viewName == null || viewName.endsWith(GSP_SUFFIX) || viewName.endsWith(JSP_SUFFIX)) {
          if (info.isParsingRequest()) {
            webRequest.informParameterCreationListeners();
          }
          String forwardUrl=WebUtils.forwardRequestForUrlMappingInfo(request,response,info);
          if (LOG.isDebugEnabled()) {
            LOG.debug("Matched URI [" + uri + "] to URL mapping ["+ info+ "], forwarding to ["+ forwardUrl+ "] with response ["+ response.getClass()+ "]");
          }
        }
 else {
          if (!renderViewForUrlMappingInfo(request,response,info,viewName)) {
            dispatched=false;
          }
        }
        break;
      }
    }
  }
  finally {
    WrappedResponseHolder.setWrappedResponse(null);
  }
  if (!dispatched) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("No match found, processing remaining filter chain.");
    }
    processFilterChain(request,response,filterChain);
  }
}
