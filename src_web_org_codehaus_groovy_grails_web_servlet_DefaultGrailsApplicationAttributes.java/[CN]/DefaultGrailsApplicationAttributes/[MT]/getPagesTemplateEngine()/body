{
  ApplicationContext appCtx=getApplicationContext();
  GroovyPagesTemplateEngine engine;
  if (appCtx.containsBean(GroovyPagesTemplateEngine.BEAN_ID)) {
    return (GroovyPagesTemplateEngine)appCtx.getBean(GroovyPagesTemplateEngine.BEAN_ID);
  }
 else {
    engine=(GroovyPagesTemplateEngine)this.context.getAttribute(GSP_TEMPLATE_ENGINE);
    if (engine == null) {
      engine=new GroovyPagesTemplateEngine(getServletContext());
      engine.setApplicationContext(getApplicationContext());
      engine.setClassLoader(getGrailsApplication().getClassLoader());
      this.context.setAttribute(GSP_TEMPLATE_ENGINE,engine);
    }
  }
  return engine;
}
