{
  GroovyClassLoader gcl=createClassLoader();
  JavaStubCompilationUnit compilation=new JavaStubCompilationUnit(config,gcl,destdir);
  int count=0;
  for (  String fileName : src.list()) {
    File basedir=getProject().resolveFile(fileName);
    if (!basedir.exists()) {
      throw new BuildException("Source directory does not exist: " + basedir,getLocation());
    }
    DirectoryScanner scanner=getDirectoryScanner(basedir);
    String[] includes=scanner.getIncludedFiles();
    log.debug("Including files from: " + basedir);
    for (    String currentInclude : includes) {
      log.debug("    " + currentInclude);
      File file=new File(basedir,currentInclude);
      if (isSource(currentInclude)) {
        compilation.addSource(file);
      }
      if (currentInclude.endsWith(".groovy")) {
        count++;
      }
    }
  }
  if (count > 0) {
    log.info("Generating " + count + " Java stub"+ (count > 1 ? "s" : "")+ " to "+ destdir);
    compilation.compile(Phases.CONVERSION);
  }
 else {
    log.info("No sources found for stub generation");
  }
}
