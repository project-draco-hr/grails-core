{
  if (str == null || len <= 0) {
    return;
  }
  if (encoder != null && (currentEncoders == null || DefaultEncodingState.shouldEncodeWith(encoder,currentEncoders))) {
    Set<Encoder> newEncoders=appendEncoders(encoder,currentEncoders);
    String source;
    if (off == 0 && len == str.length()) {
      source=str;
    }
 else {
      char[] buff=new char[len];
      str.getChars(off,off + len,buff,0);
      source=String.valueOf(buff);
    }
    String encoded=String.valueOf(encoder.encode(source));
    write(newEncoders,encoded,0,encoded.length());
  }
 else {
    write(currentEncoders,str,off,len);
  }
}
