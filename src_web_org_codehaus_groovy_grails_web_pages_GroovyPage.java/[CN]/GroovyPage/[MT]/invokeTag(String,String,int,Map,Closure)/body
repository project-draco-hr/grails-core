{
  if (tagNamespace.equals(TEMPLATE_NAMESPACE)) {
    final String tmpTagName=tagName;
    final Map tmpAttrs=attrs;
    tagName="render";
    tagNamespace=DEFAULT_NAMESPACE;
    attrs=new HashMap(){
{
        put("model",tmpAttrs);
        put("template",tmpTagName);
      }
    }
;
  }
 else   if (tagNamespace.equals(LINK_NAMESPACE)) {
    final String tmpTagName=tagName;
    final Map tmpAttrs=attrs;
    tagName="link";
    tagNamespace=DEFAULT_NAMESPACE;
    attrs=new HashMap(){
{
        if (tmpAttrs.size() > 0) {
          put("params",tmpAttrs);
        }
        put("mapping",tmpTagName);
      }
    }
;
  }
  final GrailsWebRequest webRequest=(GrailsWebRequest)getBinding().getVariable(WEB_REQUEST);
  final Writer out=webRequest.getOut();
  try {
    if (gspTagLibraryLookup.hasNamespace(tagNamespace)) {
      GroovyObject tagLib=getTagLib(tagName,tagNamespace);
      if (tagLib != null) {
        Object tagLibProp=tagLib.getProperty(tagName);
        if (tagLibProp instanceof Closure) {
          Closure tag=(Closure)((Closure)tagLibProp).clone();
switch (tag.getParameterTypes().length) {
case 1:
            tag.call(new Object[]{attrs});
          if (body != null) {
            body.call();
          }
        break;
case 2:
      if (tag.getParameterTypes().length == 2) {
        tag.call(new Object[]{attrs,body});
      }
    break;
}
}
 else {
throw new GrailsTagException("Tag [" + tagName + "] does not exist in tag library ["+ tagLib.getClass().getName()+ "]",getGroovyPageFileName(),lineNumber);
}
}
 else {
throw new GrailsTagException("Tag [" + tagName + "] does not exist. No tag library found for namespace: "+ tagNamespace,getGroovyPageFileName(),lineNumber);
}
}
 else {
StringBuilder plainTag=new StringBuilder();
String fullTagName=tagNamespace + ":" + tagName;
plainTag.append("<").append(fullTagName);
for (Object o : attrs.entrySet()) {
Map.Entry entry=(Map.Entry)o;
plainTag.append(" ").append(entry.getKey()).append("=\"").append(entry.getValue()).append("\"");
}
plainTag.append(">");
try {
out.write(plainTag.toString());
if (body != null) {
Object bodyOutput=body.call();
if (bodyOutput != null) out.write(bodyOutput.toString());
}
out.write("</" + fullTagName + ">");
}
 catch (IOException e) {
throw new GrailsTagException("I/O error invoking tag library closure as method: " + e.getMessage(),getGroovyPageFileName(),0);
}
}
}
 catch (Exception e) {
Throwable cause=GrailsExceptionResolver.getRootCause(e);
if (cause instanceof GrailsTagException) {
throw new GrailsTagException(cause.getMessage(),getGroovyPageFileName(),lineNumber);
}
 else {
throw new GrailsTagException("Error executing tag <" + tagNamespace + ":"+ tagName+ ">: "+ e.getMessage(),e,getGroovyPageFileName(),lineNumber);
}
}
 finally {
getBinding().setVariable(OUT,out);
webRequest.setOut(out);
}
}
