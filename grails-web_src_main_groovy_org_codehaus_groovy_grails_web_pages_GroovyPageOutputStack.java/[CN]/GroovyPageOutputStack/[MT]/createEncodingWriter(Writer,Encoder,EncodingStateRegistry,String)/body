{
  if (encoder == null) {
    encoder=codecSettingsLookup.lookupEncoder(codecWriterName);
  }
  Writer encodingWriter;
  if (out instanceof EncodedAppenderWriterFactory) {
    encodingWriter=((EncodedAppenderWriterFactory)out).getWriterForEncoder(encoder,encodingStateRegistry);
  }
 else {
    encodingWriter=new CodecPrintWriter(out,encoder,encodingStateRegistry);
  }
  return encodingWriter;
}
