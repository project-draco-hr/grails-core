{
  bindCollectionSecondPass(property,mappings,persistentClasses,map,sessionFactoryBeanName);
  SimpleValue value=new SimpleValue(mappings,map.getCollectionTable());
  bindSimpleValue(getIndexColumnType(property,STRING_TYPE),value,true,getIndexColumnName(property,sessionFactoryBeanName),mappings);
  PropertyConfig pc=getPropertyConfig(property);
  if (pc != null && pc.getIndexColumn() != null) {
    bindColumnConfigToColumn(getColumnForSimpleValue(value),getSingleColumnConfig(pc.getIndexColumn()));
  }
  if (!value.isTypeSpecified()) {
    throw new MappingException("map index element must specify a type: " + map.getRole());
  }
  map.setIndex(value);
  if (!property.isOneToMany() && !property.isManyToMany()) {
    SimpleValue elt=new SimpleValue(mappings,map.getCollectionTable());
    map.setElement(elt);
    String typeName=getTypeName(property,getPropertyConfig(property),getMapping(property.getDomainClass()));
    if (typeName == null) {
      if (property.isBasicCollectionType()) {
        typeName=property.getReferencedPropertyType().getName();
      }
 else {
        typeName=StandardBasicTypes.STRING.getName();
      }
    }
    bindSimpleValue(typeName,elt,false,getMapElementName(property,sessionFactoryBeanName),mappings);
    elt.setTypeName(typeName);
    map.setInverse(false);
  }
 else {
    map.setInverse(false);
  }
}
