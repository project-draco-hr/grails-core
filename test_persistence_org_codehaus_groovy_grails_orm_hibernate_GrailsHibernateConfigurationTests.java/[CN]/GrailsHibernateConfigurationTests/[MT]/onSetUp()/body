{
  Thread.currentThread().setContextClassLoader(cl);
  Class[] loadedClasses=cl.getLoadedClasses();
  grailsApplication=new DefaultGrailsApplication(loadedClasses,cl);
  DefaultGrailsDomainConfiguration config=new DefaultGrailsDomainConfiguration();
  config.setGrailsApplication(this.grailsApplication);
  Properties props=new Properties();
  props.put("hibernate.connection.username","sa");
  props.put("hibernate.connection.password","");
  props.put("hibernate.connection.url","jdbc:hsqldb:mem:grailsDB");
  props.put("hibernate.connection.driver_class","org.hsqldb.jdbcDriver");
  props.put("hibernate.dialect","org.hibernate.dialect.HSQLDialect");
  props.put("hibernate.hbm2ddl.auto","create-drop");
  config.setProperties(props);
  Thread.currentThread().setContextClassLoader(this.cl);
  this.sessionFactory=config.buildSessionFactory();
  if (!TransactionSynchronizationManager.hasResource(this.sessionFactory)) {
    Session hibSession=this.sessionFactory.openSession();
    TransactionSynchronizationManager.bindResource(this.sessionFactory,new SessionHolder(hibSession));
  }
}
