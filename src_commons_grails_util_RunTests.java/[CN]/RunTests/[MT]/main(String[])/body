{
  ApplicationContext parent=new ClassPathXmlApplicationContext("test-applicationContext.xml");
  DefaultGrailsApplication application=(DefaultGrailsApplication)parent.getBean("grailsApplication",DefaultGrailsApplication.class);
  SpringConfig config=new SpringConfig(application);
  ConfigurableApplicationContext appCtx=(ConfigurableApplicationContext)new XmlApplicationContextDriver().getApplicationContext(config.getBeanReferences(),parent);
  Class[] allClasses=application.getAllClasses();
  TestSuite s=new TestSuite();
  for (int i=0; i < allClasses.length; i++) {
    Class clazz=allClasses[i];
    if (TestCase.class.isAssignableFrom(clazz) && !Modifier.isAbstract(clazz.getModifiers())) {
      log.debug("Adding test [" + clazz.getName() + "]");
      TestCase testCaseInstance=(TestCase)BeanUtils.instantiateClass(clazz);
      appCtx.getBeanFactory().autowireBeanProperties(testCaseInstance,AutowireCapableBeanFactory.AUTOWIRE_BY_TYPE,false);
      s.addTest(testCaseInstance);
    }
 else {
      log.debug("[" + clazz.getName() + "] is not a test case.");
    }
  }
  TestRunner.run(s);
}
