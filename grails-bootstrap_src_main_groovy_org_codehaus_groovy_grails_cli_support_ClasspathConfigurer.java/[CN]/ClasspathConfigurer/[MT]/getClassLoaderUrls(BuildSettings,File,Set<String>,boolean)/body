{
  List<URL> urls=new ArrayList<URL>();
  try {
    if (settings.getGrailsHome() != null) {
      urls.add(cacheDir.toURI().toURL());
    }
    if (settings.getResourcesDir() != null && settings.getResourcesDir().exists()) {
      urls.add(settings.getResourcesDir().toURI().toURL());
    }
    final boolean dependenciesExternallyConfigured=settings.isDependenciesExternallyConfigured();
    final List<File> buildDependencies=settings.getBuildDependencies();
    if (!dependenciesExternallyConfigured && buildDependencies.isEmpty()) {
      GrailsConsole.getInstance().error("Required Grails build dependencies were not found. Either GRAILS_HOME is not set or your dependencies are misconfigured in grails-app/conf/BuildConfig.groovy");
      cleanResolveCache(settings);
      System.exit(1);
    }
    addDependenciesToURLs(excludes,urls,buildDependencies);
    addDependenciesToURLs(excludes,urls,settings.getProvidedDependencies());
    addDependenciesToURLs(excludes,urls,settings.getTestDependencies());
    settings.getRuntimeDependencies();
    settings.getCompileDependencies();
    if (!skipPlugins) {
      for (      File dir : pluginPathSupport.listKnownPluginDirs()) {
        addPluginLibs(dir,urls,settings);
      }
    }
    settings.storeDependencyCache();
  }
 catch (  ResolveException e) {
    cleanResolveCache(settings);
    GrailsConsole.getInstance().error(e.getMessage());
    System.exit(1);
  }
  return urls.toArray(new URL[urls.size()]);
}
