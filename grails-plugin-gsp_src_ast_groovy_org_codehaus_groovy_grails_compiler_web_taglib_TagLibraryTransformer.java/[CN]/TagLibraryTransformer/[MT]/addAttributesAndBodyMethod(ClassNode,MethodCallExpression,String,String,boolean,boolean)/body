{
  BlockStatement methodBody=new BlockStatement();
  ArgumentListExpression arguments=new ArgumentListExpression();
  arguments.addExpression(tagLibraryLookupMethodCall).addExpression(new ConstantExpression(namespace)).addExpression(new ConstantExpression(tagName)).addExpression(includeAttrs ? ATTRS_EXPRESSION : new MapExpression()).addExpression(includeBody ? BODY_EXPRESSION : NULL_EXPRESSION).addExpression(CURRENT_REQUEST_ATTRIBUTES_METHOD_CALL);
  methodBody.addStatement(new ExpressionStatement(new MethodCallExpression(new ClassExpression(GROOVY_PAGE_CLASS_NODE),"captureTagOutput",arguments)));
  if (includeBody && includeAttrs) {
    if (!methodExists(classNode,tagName,MAP_CLOSURE_PARAMETERS)) {
      classNode.addMethod(new MethodNode(tagName,Modifier.PUBLIC,OBJECT_CLASS,MAP_CLOSURE_PARAMETERS,null,methodBody));
    }
  }
 else   if (includeAttrs && !includeBody) {
    if (!methodExists(classNode,tagName,MAP_PARAMETERS)) {
      classNode.addMethod(new MethodNode(tagName,Modifier.PUBLIC,OBJECT_CLASS,MAP_PARAMETERS,null,methodBody));
    }
  }
 else   if (includeBody) {
    if (!methodExists(classNode,tagName,CLOSURE_PARAMETERS)) {
      classNode.addMethod(new MethodNode(tagName,Modifier.PUBLIC,OBJECT_CLASS,CLOSURE_PARAMETERS,null,methodBody));
    }
  }
 else {
    if (!methodExists(classNode,tagName,Parameter.EMPTY_ARRAY)) {
      classNode.addMethod(new MethodNode(tagName,Modifier.PUBLIC,OBJECT_CLASS,Parameter.EMPTY_ARRAY,null,methodBody));
    }
  }
}
