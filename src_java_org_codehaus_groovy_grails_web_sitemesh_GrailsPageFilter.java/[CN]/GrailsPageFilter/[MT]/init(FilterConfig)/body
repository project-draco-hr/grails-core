{
  super.init(fc);
  this.filterConfig=fc;
  containerTweaks=new ContainerTweaks();
  Config config=new Config(fc);
  DefaultFactory defaultFactory=new DefaultFactory(config);
  config.getServletContext().setAttribute("sitemesh.factory",defaultFactory);
  defaultFactory.refresh();
  FactoryHolder.setFactory(defaultFactory);
  applicationContext=WebApplicationContextUtils.getRequiredWebApplicationContext(fc.getServletContext());
  Map<String,PersistenceContextInterceptor> interceptors=applicationContext.getBeansOfType(PersistenceContextInterceptor.class);
  if (!interceptors.isEmpty()) {
    persistenceInterceptor=interceptors.values().iterator().next();
  }
}
