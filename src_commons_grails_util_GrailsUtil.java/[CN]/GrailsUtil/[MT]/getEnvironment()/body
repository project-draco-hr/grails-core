{
  GrailsApplication app=ApplicationHolder.getApplication();
  String envName=null;
  if (app != null) {
    Map metadata=app.getMetadata();
    if (metadata != null)     envName=(String)metadata.get(GrailsApplication.ENVIRONMENT);
  }
  if (StringUtils.isBlank(envName))   envName=System.getProperty(GrailsApplication.ENVIRONMENT);
  if (StringUtils.isBlank(envName)) {
    return GrailsApplication.ENV_DEVELOPMENT;
  }
 else {
    if (envNameMappings.containsKey(envName)) {
      return (String)envNameMappings.get(envName);
    }
 else {
      return envName;
    }
  }
}
