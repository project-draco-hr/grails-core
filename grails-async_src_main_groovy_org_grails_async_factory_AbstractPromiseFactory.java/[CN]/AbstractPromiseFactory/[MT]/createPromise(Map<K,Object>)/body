{
  PromiseMap<K,V> promiseMap=new PromiseMap<K,V>();
  for (  Map.Entry<K,Object> entry : map.entrySet()) {
    K key=entry.getKey();
    Object value=entry.getValue();
    if (value instanceof Promise) {
      promiseMap.put(key,(Promise)value);
    }
 else     if (value instanceof Closure) {
      Closure c=(Closure)value;
      promiseMap.put(key,createPromise(c));
    }
 else {
      promiseMap.put(key,new DefaultBoundPromise<V>((V)value));
    }
  }
  return promiseMap;
}
