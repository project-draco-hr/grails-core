{
  if (applicationContext instanceof GenericApplicationContext) {
    GenericApplicationContext ctx=(GenericApplicationContext)applicationContext;
    GrailsDataSource dataSource=application.getGrailsDataSource();
    if (dataSource != null && dataSource.isPooled()) {
      RootBeanDefinition bd=new RootBeanDefinition(BasicDataSource.class);
      MutablePropertyValues mpv=new MutablePropertyValues();
      mpv.addPropertyValue("driverClassName",dataSource.getDriverClassName());
      mpv.addPropertyValue("url",dataSource.getUrl());
      mpv.addPropertyValue("username",dataSource.getUsername());
      mpv.addPropertyValue("password",dataSource.getPassword());
      bd.setPropertyValues(mpv);
      bd.setDestroyMethodName("close");
      ctx.registerBeanDefinition("dataSource",bd);
    }
  }
}
