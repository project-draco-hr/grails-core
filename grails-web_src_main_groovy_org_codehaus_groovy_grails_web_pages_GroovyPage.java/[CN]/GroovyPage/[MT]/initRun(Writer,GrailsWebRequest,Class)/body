{
  outputStack=GroovyPageOutputStack.currentStack(true,target,false,true);
  out=outputStack.getProxyWriter();
  this.webRequest=grailsWebRequest;
  final Map map=getBinding().getVariables();
  GrailsApplication grailsApplication=null;
  if (map.containsKey(APPLICATION_CONTEXT)) {
    final ApplicationContext applicationContext=(ApplicationContext)map.get(APPLICATION_CONTEXT);
    if (applicationContext != null && applicationContext.containsBean(GrailsPluginManager.BEAN_NAME)) {
      final GrailsPluginManager pluginManager=applicationContext.getBean(GrailsPluginManager.BEAN_NAME,GrailsPluginManager.class);
      pluginContextPath=pluginManager.getPluginPathForInstance(this);
      grailsApplication=applicationContext.getBean(GrailsApplication.APPLICATION_ID,GrailsApplication.class);
    }
  }
  if (grailsWebRequest != null) {
    grailsWebRequest.setOut(out);
    if (grailsApplication == null) {
      grailsApplication=grailsWebRequest.getAttributes().getGrailsApplication();
    }
  }
  getBinding().setVariable(OUT,out);
  if (codecClass != null) {
    codecOut=new CodecPrintWriter(grailsApplication,out,codecClass);
  }
 else {
    codecOut=out;
  }
  getBinding().setVariable(CODEC_OUT,codecOut);
}
