{
  SessionFactory sessionFactory=hibernateEvent.getSession().getSessionFactory();
  if (!(sessionFactory instanceof SessionFactoryProxy)) {
    for (    Map.Entry<SessionFactory,HibernateDatastore> entry : datastores.entrySet()) {
      SessionFactory sf=entry.getKey();
      if (sf instanceof SessionFactoryProxy) {
        if (((SessionFactoryProxy)sf).getCurrentSessionFactory() == sessionFactory) {
          return entry.getValue();
        }
      }
    }
  }
  Datastore datastore=datastores.get(sessionFactory);
  if (datastore == null && datastores.size() == 1) {
    datastore=datastores.values().iterator().next();
  }
  return datastore;
}
