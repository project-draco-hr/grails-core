{
  final UrlMappingsListKey lookupKey=new UrlMappingsListKey(controller,action);
  SortedSet mappingKeysSet=mappingsListLookup.get(lookupKey);
  final String actionName=lookupKey.action;
  boolean secondAttempt=false;
  final boolean isIndexAction=GrailsControllerClass.INDEX_ACTION.equals(actionName);
  if (null == mappingKeysSet && actionName != null) {
    lookupKey.action=null;
    mappingKeysSet=mappingsListLookup.get(lookupKey);
    secondAttempt=true;
  }
  if (null == mappingKeysSet)   return null;
  UrlMappingKey[] mappingKeys=(UrlMappingKey[])mappingKeysSet.toArray(new UrlMappingKey[mappingKeysSet.size()]);
  Set mappingConstraintNames=new HashSet();
  for (int i=mappingKeys.length; i > 0; i--) {
    UrlMappingKey mappingKey=mappingKeys[i - 1];
    if (params.keySet().containsAll(mappingKey.paramNames)) {
      final UrlMapping mapping=mappingsLookup.get(mappingKey);
      if (canInferAction(actionName,secondAttempt,isIndexAction,mapping))       return mapping;
 else       if (!secondAttempt)       return mapping;
    }
  }
  return null;
}
