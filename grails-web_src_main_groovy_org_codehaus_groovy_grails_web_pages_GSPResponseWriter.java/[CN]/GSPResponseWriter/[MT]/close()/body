{
  flush();
  if (CONTENT_LENGTH_COUNTING_ENABLED && bytesCounter != null && response != null && !response.isCommitted()) {
    int size=bytesCounter.size();
    if (size > 0) {
      response.setContentLength(size);
    }
    flushResponse();
  }
 else {
    GrailsWebRequest webRequest=GrailsWebRequest.lookup();
    if (webRequest != null && webRequest.getCurrentRequest().getAttribute(RequestConstants.PAGE) != null) {
      flushResponse();
    }
  }
}
