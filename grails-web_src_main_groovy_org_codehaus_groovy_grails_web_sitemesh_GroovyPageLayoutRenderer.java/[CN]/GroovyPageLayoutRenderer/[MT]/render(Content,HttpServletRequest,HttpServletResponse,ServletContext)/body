{
  HTMLPage htmlPage=content2htmlPage(content);
  request.setAttribute(RequestConstants.PAGE,htmlPage);
  if (decorator.getURIPath() != null) {
    if (servletContext.getContext(decorator.getURIPath()) != null) {
      servletContext=servletContext.getContext(decorator.getURIPath());
    }
  }
  if (!response.isCommitted()) {
    boolean dispatched=false;
    try {
      request.setAttribute(GrailsPageFilter.ALREADY_APPLIED_KEY,Boolean.TRUE);
      try {
        View view=viewResolver.resolveViewName(decorator.getPage(),request.getLocale());
        view.render(Collections.<String,Object>emptyMap(),request,response);
        dispatched=true;
        if (!response.isCommitted()) {
          response.getWriter().flush();
        }
      }
 catch (      Exception e) {
        cleanRequestAttributes(request);
        throw new GroovyPagesException("Error applying layout : " + decorator.getPage(),e);
      }
    }
  finally {
      if (!dispatched) {
        cleanRequestAttributes(request);
      }
    }
  }
  request.removeAttribute(RequestConstants.PAGE);
}
