{
  if (target instanceof GrailsPrintWriter) {
    GrailsPrintWriter gpw=((GrailsPrintWriter)target);
    if (gpw.isAllowUnwrappingOut()) {
      target=gpw.getOut();
    }
  }
  if (target instanceof StreamCharBufferWriter) {
    if (target == writer) {
      throw new IllegalArgumentException("Cannot write buffer to itself.");
    }
    ((StreamCharBufferWriter)target).write(this);
    return;
  }
  writeToImpl(target,flushTarget,emptyAfter);
}
