{
  GroovyClassLoader cl=new GroovyClassLoader();
  cl.parseClass("class Specialty {\n" + "    Long id \n" + "    Long version \n"+ "    String name \n"+ "    Set vets \n"+ "    static hasMany = [vets:Vet] \n"+ "    static belongsTo = Vet \n"+ "} \n"+ "class Vet {\n"+ "    Long id \n"+ "    Long version \n"+ "    Set specialities \n"+ "    static hasMany = [specialities:Specialty] \n"+ "}");
  DefaultGrailsDomainConfiguration config=getDomainConfig(cl,cl.getLoadedClasses());
  int totalTables=0;
  for (Iterator tableMappings=config.getTableMappings(); tableMappings.hasNext(); ) {
    totalTables++;
    Table table=(Table)tableMappings.next();
    if ("vet_specialty".equals(table.getName())) {
      int vetSpecialtyFks=0;
      for (Iterator fks=table.getForeignKeyIterator(); fks.hasNext(); fks.next()) {
        vetSpecialtyFks++;
      }
      assertEquals("VET_SPECIALTY table has FK's",2,vetSpecialtyFks);
    }
  }
  assertEquals("Number of tables",3,totalTables);
}
