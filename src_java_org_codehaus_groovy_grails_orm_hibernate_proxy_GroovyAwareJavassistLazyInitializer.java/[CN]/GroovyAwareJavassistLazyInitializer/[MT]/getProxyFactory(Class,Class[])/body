{
  try {
    ProxyFactory factory=new ProxyFactory();
    factory.setSuperclass(interfaces.length == 1 ? persistentClass : null);
    factory.setInterfaces(interfaces);
    factory.setFilter(METHOD_FILTERS);
    if (WRITE_CLASSES_DIRECTORY != null) {
      factory.writeDirectory=WRITE_CLASSES_DIRECTORY;
    }
    Class proxyClass=factory.createClass();
    HibernatePluginSupport.enhanceProxyClass(proxyClass);
    return proxyClass;
  }
 catch (  Throwable t) {
    LoggerFactory.getLogger(BasicLazyInitializer.class).error("Javassist Enhancement failed: " + persistentClass.getName(),t);
    throw new HibernateException("Javassist Enhancement failed: " + persistentClass.getName(),t);
  }
}
