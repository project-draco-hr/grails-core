{
  Assert.notNull(dataSource,"Data source is not set!");
  Assert.notNull(vendorNameDialectMappings,"Vendor name/dialect mappings are not set!");
  Connection connection=null;
  String dbName=(String)JdbcUtils.extractDatabaseMetaData(dataSource,"getDatabaseProductName");
  try {
    connection=DataSourceUtils.getConnection(dataSource);
    try {
      hibernateDialect=DialectFactory.buildDialect(grailsApplication.getConfig().toProperties(),connection);
      hibernateDialectClassName=hibernateDialect.getClass().getName();
    }
 catch (    HibernateException e) {
      hibernateDialectClassName=vendorNameDialectMappings.getProperty(dbName);
    }
    if (!StringUtils.hasText(hibernateDialectClassName)) {
      throw new CouldNotDetermineHibernateDialectException("Could not determine Hibernate dialect for database name [" + dbName + "]!");
    }
  }
  finally {
    DataSourceUtils.releaseConnection(connection,dataSource);
  }
}
