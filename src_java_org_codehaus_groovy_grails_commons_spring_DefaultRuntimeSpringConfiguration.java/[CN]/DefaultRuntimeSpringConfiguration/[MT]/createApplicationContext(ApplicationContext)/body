{
  if (parentCtx != null && beanFactory != null) {
    if (beanFactory instanceof DefaultListableBeanFactory) {
      return new GrailsApplicationContext((DefaultListableBeanFactory)beanFactory,parentCtx);
    }
    throw new IllegalArgumentException("ListableBeanFactory set must be a subclass of DefaultListableBeanFactory");
  }
  if (beanFactory != null) {
    if (beanFactory instanceof DefaultListableBeanFactory) {
      return new GrailsApplicationContext((DefaultListableBeanFactory)beanFactory);
    }
    throw new IllegalArgumentException("ListableBeanFactory set must be a subclass of DefaultListableBeanFactory");
  }
  if (parentCtx != null) {
    return new GrailsApplicationContext(parentCtx);
  }
  return new GrailsApplicationContext();
}
