{
  final Thread currentThread=Thread.currentThread();
  ClassLoader cl=currentThread.getContextClassLoader();
  try {
    currentThread.setContextClassLoader(application.getClassLoader());
    FlowExecutorArgumentHandler argumentHandler=new GrailsConventionsFlowExecutorArgumentHandler(webRequest);
    FlowExecutor flowExecutor=getFlowExecutor();
    if (flowExecutor == null) {
      throw new ControllerExecutionException("No [flowExecutor] found. This is likely a configuration problem, check your version of Grails.");
    }
    ServletExternalContext externalContext=new ServletExternalContext(getServletContext(),request,response){
      public String getDispatcherPath(){
        String forwardURI=(String)request.getAttribute(WebUtils.FORWARD_REQUEST_URI_ATTRIBUTE);
        UrlPathHelper pathHelper=new UrlPathHelper();
        String contextPath=pathHelper.getContextPath(request);
        if (forwardURI.startsWith(contextPath)) {
          return forwardURI.substring(contextPath.length(),forwardURI.length());
        }
 else {
          return forwardURI;
        }
      }
    }
;
    ResponseInstruction responseInstruction=createRequestHandler(argumentHandler).handleFlowRequest(externalContext);
    return toModelAndView(responseInstruction,externalContext,argumentHandler);
  }
  finally {
    currentThread.setContextClassLoader(cl);
  }
}
