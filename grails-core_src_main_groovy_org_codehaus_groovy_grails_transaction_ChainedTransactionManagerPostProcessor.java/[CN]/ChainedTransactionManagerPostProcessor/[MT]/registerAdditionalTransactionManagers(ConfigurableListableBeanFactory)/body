{
  String[] beanNames=BeanFactoryUtils.beanNamesForTypeIncludingAncestors(beanFactory,PlatformTransactionManager.class,false,false);
  List<PlatformTransactionManager> additionalTransactionManagers=new ArrayList<PlatformTransactionManager>();
  Map<String,ConfigObject> dsConfigs=readDataSourceConfig();
  for (  String beanName : beanNames) {
    if (!TRANSACTION_MANAGER.equals(beanName) && !PRIMARY_TRANSACTION_MANAGER.equals(beanName) && isValidTransactionManagerBeanName(beanName)) {
      String suffix=resolveDataSourceSuffix(beanName);
      if (!isNotTransactional(dsConfigs,suffix)) {
        additionalTransactionManagers.add(beanFactory.getBean(beanName,PlatformTransactionManager.class));
      }
    }
  }
  ChainedTransactionManager chainedTransactionManager=beanFactory.getBean(TRANSACTION_MANAGER,ChainedTransactionManager.class);
  chainedTransactionManager.getTransactionManagers().addAll(additionalTransactionManagers);
}
