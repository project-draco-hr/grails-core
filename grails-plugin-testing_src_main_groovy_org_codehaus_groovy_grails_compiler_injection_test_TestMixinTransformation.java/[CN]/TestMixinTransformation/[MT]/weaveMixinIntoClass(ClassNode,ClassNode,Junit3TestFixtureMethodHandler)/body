{
  final String fieldName='$' + GrailsNameUtils.getPropertyName(mixinClassNode.getName());
  boolean implementsClassRuleFactory=GrailsASTUtils.findInterface(mixinClassNode,ClassHelper.make(ClassRuleFactory.class)) != null;
  boolean implementsRuleFactory=GrailsASTUtils.findInterface(mixinClassNode,ClassHelper.make(RuleFactory.class)) != null;
  FieldNode fieldNode=null;
  if (!(implementsClassRuleFactory || implementsRuleFactory)) {
    fieldNode=addLegacyMixinFieldIfNonExistent(classNode,mixinClassNode,fieldName);
  }
 else {
    fieldNode=addTestRuleMixinFieldIfNonExistent(classNode,mixinClassNode,fieldName,implementsClassRuleFactory,implementsRuleFactory);
  }
  if (fieldNode == null)   return;
  VariableExpression fieldReference=new VariableExpression(fieldName);
  while (!mixinClassNode.getName().equals(OBJECT_CLASS)) {
    final List<MethodNode> mixinMethods=mixinClassNode.getMethods();
    for (    MethodNode mixinMethod : mixinMethods) {
      if (!isCandidateMethod(mixinMethod) || hasDeclaredMethod(classNode,mixinMethod)) {
        continue;
      }
      MethodNode methodNode;
      if (mixinMethod.isStatic()) {
        methodNode=GrailsASTUtils.addDelegateStaticMethod(classNode,mixinMethod);
      }
 else {
        methodNode=GrailsASTUtils.addDelegateInstanceMethod(classNode,fieldReference,mixinMethod,false);
      }
      if (methodNode != null) {
        methodNode.addAnnotation(MIXIN_METHOD_ANNOTATION);
        GrailsASTUtils.addCompileStaticAnnotation(methodNode);
      }
      if (junit3MethodHandler != null) {
        junit3MethodHandler.handle(mixinMethod,methodNode);
      }
    }
    mixinClassNode=mixinClassNode.getSuperClass();
    if (junit3MethodHandler != null) {
      junit3MethodHandler.mixinSuperClassChanged();
    }
  }
}
