{
  GroovyClassLoader gcl=new GroovyClassLoader();
  Class dc=gcl.parseClass("class Test { Long id; Long version; }");
  GrailsApplication app=new DefaultGrailsApplication(new Class[]{dc},gcl);
  MockApplicationContext parent=new MockApplicationContext();
  parent.registerMockBean(GrailsApplication.APPLICATION_ID,app);
  GrailsRuntimeConfigurator conf=new GrailsRuntimeConfigurator(app,parent);
  conf.setLoadExternalPersistenceConfig(false);
  GrailsWebApplicationContext ctx=(GrailsWebApplicationContext)conf.configure(new MockServletContext());
  assertNotNull(ctx);
  gcl=new GroovyClassLoader();
  dc=gcl.parseClass("class Test { Long id; Long version; }");
  GrailsDomainClass domainClass=new DefaultGrailsDomainClass(dc);
  conf.updateDomainClass(domainClass,ctx);
  conf.refreshSessionFactory(app,ctx);
}
