{
  super.init(fc);
  this.filterConfig=fc;
  containerTweaks=new ContainerTweaks();
  Config config=new Config(fc);
  Grails5535Factory defaultFactory=new Grails5535Factory(config);
  fc.getServletContext().setAttribute(FACTORY_SERVLET_CONTEXT_ATTRIBUTE,defaultFactory);
  defaultFactory.refresh();
  FactoryHolder.setFactory(defaultFactory);
  contentProcessor=new PageParser2ContentProcessor(defaultFactory);
  decoratorMapper=defaultFactory.getDecoratorMapper();
  applicationContext=WebApplicationContextUtils.getRequiredWebApplicationContext(fc.getServletContext());
  layoutViewResolver=WebUtils.lookupViewResolver(applicationContext);
  final GrailsApplication grailsApplication=GrailsWebUtil.lookupApplication(fc.getServletContext());
  String encoding=(String)grailsApplication.getFlatConfig().get(CONFIG_OPTION_GSP_ENCODING);
  if (encoding != null) {
    defaultEncoding=encoding;
  }
  Map<String,PersistenceContextInterceptor> interceptors=applicationContext.getBeansOfType(PersistenceContextInterceptor.class);
  if (!interceptors.isEmpty()) {
    persistenceInterceptor=interceptors.values().iterator().next();
  }
}
