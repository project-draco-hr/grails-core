{
  MockApplicationContext context=new MockApplicationContext();
  MockServletContext servletContext=new MockServletContext();
  servletContext.setAttribute(GrailsApplicationAttributes.APPLICATION_CONTEXT,context);
  GrailsApplication app=new DefaultGrailsApplication(classes,gcl);
  context.registerMockBean(GrailsApplication.APPLICATION_ID,app);
  for (int i=0; i < app.getControllers().length; i++) {
    context.registerMockBean(app.getControllers()[i].getFullName(),app.getControllers()[i].newInstance());
  }
  for (int i=0; i < app.getGrailsTabLibClasses().length; i++) {
    context.registerMockBean(app.getGrailsTabLibClasses()[i].getFullName(),app.getGrailsTabLibClasses()[i].newInstance());
  }
  return new DefaultGrailsApplicationAttributes(servletContext);
}
