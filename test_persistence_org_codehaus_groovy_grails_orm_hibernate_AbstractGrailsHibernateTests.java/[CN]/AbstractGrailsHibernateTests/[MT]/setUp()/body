{
  super.setUp();
  onSetUp();
  ga=new DefaultGrailsApplication(gcl.getLoadedClasses(),gcl);
  DefaultGrailsDomainConfiguration config=new DefaultGrailsDomainConfiguration();
  config.setGrailsApplication(this.ga);
  Properties props=new Properties();
  props.put("hibernate.connection.username","sa");
  props.put("hibernate.connection.password","");
  props.put("hibernate.connection.url","jdbc:hsqldb:mem:grailsDB");
  props.put("hibernate.connection.driver_class","org.hsqldb.jdbcDriver");
  props.put("hibernate.dialect","org.hibernate.dialect.HSQLDialect");
  props.put("hibernate.hbm2ddl.auto","create-drop");
  config.setProperties(props);
  Thread.currentThread().setContextClassLoader(this.gcl);
  this.sessionFactory=config.buildSessionFactory();
  GrailsDomainConfigurationUtil.configureDynamicMethods(sessionFactory,ga);
  if (!TransactionSynchronizationManager.hasResource(this.sessionFactory)) {
    this.session=this.sessionFactory.openSession();
    TransactionSynchronizationManager.bindResource(this.sessionFactory,new SessionHolder(session));
  }
}
