{
  ClassLoader cl=Thread.currentThread().getContextClassLoader();
  try {
    Closure action;
    try {
      action=(Closure)controller.getProperty(actionName);
    }
 catch (    MissingPropertyException mpe) {
      if (controllerClass.isScaffolding())       throw new IllegalStateException("Scaffolder supports action [" + actionName + "] for controller ["+ controllerClass.getFullName()+ "] but getAction returned null!");
 else {
        try {
          response.sendError(HttpServletResponse.SC_NOT_FOUND);
          return null;
        }
 catch (        IOException e) {
          throw new ControllerExecutionException("I/O error sending 404 error",e);
        }
      }
    }
    Object returnValue=handleAction(controller,action,request,response,params);
    initChainModel(controller);
    if (response.isCommitted()) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Response has been redirected, returning null model and view");
      }
      return null;
    }
 else {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Action [" + actionName + "] executed with result ["+ returnValue+ "] and view name ["+ viewName+ "]");
      }
      ModelAndView mv=handleActionResponse(controller,returnValue,actionName,viewName);
      if (LOG.isDebugEnabled()) {
        LOG.debug("Action [" + actionName + "] handled, created Spring model and view ["+ mv+ "]");
      }
      return mv;
    }
  }
  finally {
    Thread.currentThread().setContextClassLoader(cl);
  }
}
