{
  if (totalCount == Integer.MIN_VALUE) {
    totalCount=(Integer)hibernateTemplate.execute(new HibernateCallback<Object>(){
      public Object doInHibernate(      Session session) throws HibernateException, SQLException {
        CriteriaImpl impl=(CriteriaImpl)criteria;
        Criteria totalCriteria=session.createCriteria(impl.getEntityOrClassName());
        hibernateTemplate.applySettings(totalCriteria);
        Iterator iterator=impl.iterateExpressionEntries();
        while (iterator.hasNext()) {
          CriteriaImpl.CriterionEntry entry=(CriteriaImpl.CriterionEntry)iterator.next();
          totalCriteria.add(entry.getCriterion());
        }
        totalCriteria.setProjection(impl.getProjection());
        totalCriteria.setProjection(Projections.rowCount());
        return ((Number)totalCriteria.uniqueResult()).intValue();
      }
    }
);
  }
  return totalCount;
}
