{
  if (templateEngine == null)   throw new IllegalStateException("Property [templateEngine] must be set!");
  if (templateGenerator == null)   throw new IllegalStateException("Property [templateGenerator] must be set!");
  if (resolver == null)   throw new IllegalStateException("Property [resolver] must be set!");
  if (scaffoldedClass == null)   throw new IllegalStateException("Property [scaffoldedClass] must be set!");
  if (grailsApplication == null)   throw new IllegalStateException("Property [grailsApplication] must be set!");
  GrailsDomainClass domainClass=(GrailsDomainClass)grailsApplication.getArtefact(DomainClassArtefactHandler.TYPE,scaffoldedClass.getName());
  GrailsControllerClass controllerClass=grailsApplication.getScaffoldingController(domainClass);
  String uri=controllerClass.getViewByName(actionName);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Scaffolding response for view URI: " + uri);
  }
  try {
    View v=resolver.resolveViewName(uri,RequestContextUtils.getLocale(request));
    if (v instanceof AbstractUrlBasedView) {
      uri=((AbstractUrlBasedView)v).getUrl();
      Resource r=null;
      if (uri.endsWith(GroovyPage.EXTENSION)) {
        r=templateEngine.getResourceForUri(uri);
      }
      if (r != null && r.exists()) {
        return new ModelAndView(v,model);
      }
 else {
        return createScaffoldedResponse(uri,model,actionName);
      }
    }
 else {
      return createScaffoldedResponse(uri,model,actionName);
    }
  }
 catch (  Exception e) {
    throw new ScaffoldingException("Unable to render scaffolded view for uri [" + uri + "]:"+ e.getMessage(),e);
  }
}
