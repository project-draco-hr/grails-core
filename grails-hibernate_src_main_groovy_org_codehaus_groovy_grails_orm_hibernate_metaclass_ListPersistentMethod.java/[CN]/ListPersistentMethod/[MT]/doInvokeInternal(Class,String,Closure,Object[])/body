{
  return getHibernateTemplate().executeFind(new HibernateCallback<Object>(){
    public Object doInHibernate(    Session session) throws HibernateException, SQLException {
      Criteria c=session.createCriteria(clazz);
      getHibernateTemplate().applySettings(c);
      if (arguments.length > 0 && arguments[0] instanceof Map) {
        Map argMap=(Map)arguments[0];
        if (argMap.containsKey(GrailsHibernateUtil.ARGUMENT_MAX)) {
          c.setFirstResult(0);
          c.setMaxResults(Integer.MAX_VALUE);
          c.setProjection(Projections.rowCount());
          int totalCount=((Number)c.uniqueResult()).intValue();
          c.setProjection(null);
          GrailsHibernateUtil.populateArgumentsForCriteria(application,clazz,c,argMap);
          c.setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY);
          PagedResultList pagedResultList=new PagedResultList(c.list());
          pagedResultList.setTotalCount(totalCount);
          return pagedResultList;
        }
        GrailsHibernateUtil.populateArgumentsForCriteria(application,clazz,c,argMap);
        c.setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY);
        return c.list();
      }
      GrailsHibernateUtil.populateArgumentsForCriteria(application,clazz,c,Collections.EMPTY_MAP);
      c.setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY);
      return c.list();
    }
  }
);
}
