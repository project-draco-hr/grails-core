{
  Assert.notNull(grailsApplication,"The property [grailsApplication] must be set!");
  ConversationManager conversationManagerToUse=conversationManager;
  if (conversationManagerToUse == null) {
    conversationManagerToUse=createDefaultConversationManager();
  }
  if (repositoryType == RepositoryType.CLIENT) {
    if (conversationManager == null) {
      return new GrailsAwareClientContinuationFlowExecutionRepository(executionStateRestorer,grailsApplication);
    }
 else {
      return new GrailsAwareClientContinuationFlowExecutionRepository(executionStateRestorer,conversationManager,grailsApplication);
    }
  }
 else   if (repositoryType == RepositoryType.CONTINUATION) {
    ContinuationFlowExecutionRepository repository=new GrailsAwareContinuationFlowExecutionRepository(executionStateRestorer,conversationManagerToUse,grailsApplication);
    if (getMaxContinuations() != null) {
      repository.setMaxContinuations(getMaxContinuations().intValue());
    }
    return repository;
  }
 else {
    return super.createExecutionRepository(repositoryType,executionStateRestorer,conversationManager);
  }
}
