{
  GroovyClassLoader cl=this.grailsApplication.getClassLoader();
  String unique=(uniqueResult ? ",true" : "");
  Class clazz=cl.parseClass("package test;\n" + "import grails.orm.*;\n" + "import org.hibernate.*;\n"+ "class " + testClassName + " {\n"+ "SessionFactory sf;\n"+ "Class tc;\n"+ "Closure test = {\n"+ "def hcb = new HibernateCriteriaBuilder(tc,sf"+ unique+ ");\n"+ "return hcb"+ groovy+ ";\n"+ "}\n"+ "}");
  GroovyObject go=(GroovyObject)clazz.newInstance();
  go.setProperty("sf",this.sessionFactory);
  Class tc=this.grailsApplication.getArtefact(DomainClassArtefactHandler.TYPE,criteriaClassName).getClazz();
  go.setProperty("tc",tc);
  Closure closure=(Closure)go.getProperty("test");
  return (Proxy)closure.call();
}
