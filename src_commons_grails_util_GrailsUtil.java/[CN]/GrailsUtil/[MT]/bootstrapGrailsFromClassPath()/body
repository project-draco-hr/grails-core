{
  LOG.info("Loading Grails environment");
  ApplicationContext parent=new ClassPathXmlApplicationContext("applicationContext.xml");
  DefaultGrailsApplication application=(DefaultGrailsApplication)parent.getBean("grailsApplication",DefaultGrailsApplication.class);
  GrailsRuntimeConfigurator config=new GrailsRuntimeConfigurator(application,parent);
  MockServletContext servletContext=new MockServletContext(new DefaultResourceLoader(){
    public Resource getResource(    String location){
      Resource r=super.getResource(location);
      if (!r.exists() && isNotPrefixed(location)) {
        if (!location.startsWith("/"))         location="/" + location;
        r=new FileSystemResource(new File("./web-app/WEB-INF" + location));
      }
      return r;
    }
  }
);
  ConfigurableApplicationContext appCtx=(ConfigurableApplicationContext)config.configure(servletContext);
  servletContext.setAttribute(ApplicationAttributes.APPLICATION_CONTEXT,appCtx);
  Assert.notNull(appCtx);
  return appCtx;
}
