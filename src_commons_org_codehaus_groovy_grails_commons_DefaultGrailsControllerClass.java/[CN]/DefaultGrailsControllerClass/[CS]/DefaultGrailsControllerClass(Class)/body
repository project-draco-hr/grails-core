{
  super(clazz,CONTROLLER);
  this.uri=SLASH + WordUtils.uncapitalize(getName());
  defaultActionName=(String)getPropertyOrStaticPropertyOrFieldValue(DEFAULT_CLOSURE_PROPERTY,String.class);
  if (defaultActionName == null) {
    defaultActionName=INDEX_ACTION;
  }
  this.scaffoldedClass=(Class)getPropertyOrStaticPropertyOrFieldValue(SCAFFOLDING_PROPERTY,Class.class);
  if (this.scaffoldedClass != null) {
    this.scaffolding=true;
  }
 else {
    if (getReference().isReadableProperty(SCAFFOLDING_PROPERTY)) {
      Object tmp=getReference().getPropertyValue(SCAFFOLDING_PROPERTY);
      if (tmp instanceof Boolean) {
        this.scaffolding=((Boolean)tmp).booleanValue();
      }
    }
  }
  Collection closureNames=new ArrayList();
  this.uri2viewMap=new HashMap();
  this.uri2closureMap=new HashMap();
  this.viewNames=new HashMap();
  final String controllerPath=uri + SLASH;
  if (this.scaffolding) {
    this.uri2closureMap.put(uri,defaultActionName);
    this.uri2closureMap.put(controllerPath,defaultActionName);
    this.uri2viewMap.put(controllerPath,controllerPath + defaultActionName);
    this.uri2viewMap.put(uri,controllerPath + defaultActionName);
    this.viewNames.put(defaultActionName,controllerPath + defaultActionName);
    for (int i=0; i < GrailsScaffolder.ACTION_NAMES.length; i++) {
      closureNames.add(GrailsScaffolder.ACTION_NAMES[i]);
      String viewName=(String)getPropertyOrStaticPropertyOrFieldValue(GrailsScaffolder.ACTION_NAMES[i] + VIEW,String.class);
      if (viewName == null) {
        viewName=GrailsScaffolder.ACTION_NAMES[i];
      }
      String tmpUri=controllerPath + GrailsScaffolder.ACTION_NAMES[i];
      String viewUri=controllerPath + viewName;
      if (StringUtils.isNotBlank(viewName)) {
        this.uri2viewMap.put(tmpUri,viewUri);
        this.viewNames.put(GrailsScaffolder.ACTION_NAMES[i],viewUri);
      }
      this.uri2closureMap.put(tmpUri,GrailsScaffolder.ACTION_NAMES[i]);
      this.uri2closureMap.put(tmpUri + SLASH + "**",GrailsScaffolder.ACTION_NAMES[i]);
    }
  }
  PropertyDescriptor[] propertyDescriptors=getReference().getPropertyDescriptors();
  for (int i=0; i < propertyDescriptors.length; i++) {
    PropertyDescriptor propertyDescriptor=propertyDescriptors[i];
    Closure closure=(Closure)getPropertyOrStaticPropertyOrFieldValue(propertyDescriptor.getName(),Closure.class);
    if (closure != null) {
      String closureName=propertyDescriptor.getName();
      if (closureName.endsWith(FLOW_SUFFIX)) {
        String flowId=closureName.substring(0,closureName.length() - FLOW_SUFFIX.length());
        flows.put(flowId,closure);
        closureName=flowId;
      }
 else {
        Class[] parameterTypes=closure.getParameterTypes();
        if (parameterTypes != null && parameterTypes.length > 0) {
          for (int j=0; j < parameterTypes.length; j++) {
            Class parameterType=parameterTypes[j];
            if (GroovyObject.class.isAssignableFrom(parameterType)) {
              commandObjectActions.add(closureName);
              commandObjectClasses.add(parameterType);
            }
          }
        }
      }
      closureNames.add(closureName);
      String viewName=(String)getPropertyOrStaticPropertyOrFieldValue(propertyDescriptor.getName() + VIEW,String.class);
      if (viewName == null) {
        viewName=closureName;
      }
      String tmpUri=controllerPath + closureName;
      String viewUri=controllerPath + viewName;
      uri2closureMap.put(tmpUri,closureName);
      uri2closureMap.put(tmpUri + SLASH + "**",closureName);
      if (StringUtils.isNotBlank(viewName)) {
        this.uri2viewMap.put(tmpUri,viewUri);
        this.viewNames.put(closureName,viewUri);
      }
    }
  }
  if (getReference().isReadableProperty(defaultActionName)) {
    this.uri2closureMap.put(uri,defaultActionName);
    this.uri2closureMap.put(controllerPath,defaultActionName);
    this.uri2viewMap.put(controllerPath,controllerPath + defaultActionName);
    this.uri2viewMap.put(uri,controllerPath + defaultActionName);
    this.viewNames.put(defaultActionName,controllerPath + defaultActionName);
  }
  if (closureNames.size() == 1) {
    String closureName=((String)closureNames.iterator().next());
    this.defaultActionName=closureName;
    this.uri2closureMap.put(uri,closureName);
    this.uri2closureMap.put(controllerPath,closureName);
    if (!this.uri2viewMap.isEmpty()) {
      this.uri2viewMap.put(uri,this.uri2viewMap.values().iterator().next());
    }
  }
  this.uris=(String[])this.uri2closureMap.keySet().toArray(new String[this.uri2closureMap.keySet().size()]);
}
