{
  ClassLoader cl=classLoader != null ? classLoader : Thread.currentThread().getContextClassLoader();
  if (configClass == null) {
    try {
      configClass=cl.loadClass("org.codehaus.groovy.grails.orm.hibernate.cfg.GrailsAnnotationConfiguration");
    }
 catch (    Throwable e) {
      configClass=DefaultGrailsDomainConfiguration.class;
    }
  }
  Object config=BeanUtils.instantiateClass(configClass);
  if (config instanceof GrailsDomainConfiguration) {
    GrailsDomainConfiguration grailsConfig=(GrailsDomainConfiguration)config;
    grailsConfig.setGrailsApplication(grailsApplication);
    grailsConfig.setSessionFactoryBeanName(sessionFactoryBeanName);
    grailsConfig.setDataSourceName(dataSourceName);
  }
  if (currentSessionContextClass != null) {
    ((Configuration)config).setProperty(Environment.CURRENT_SESSION_CONTEXT_CLASS,currentSessionContextClass.getName());
    setExposeTransactionAwareSessionFactory(false);
  }
  return (Configuration)config;
}
