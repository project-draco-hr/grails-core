{
  GroovyObject pageFlow=(GroovyObject)this.applicationContext.getBean(pageFlowClass.getFullName());
  Assert.notNull(pageFlow);
  Flow flow=(Flow)pageFlow.getProperty(FLOW);
  Assert.notNull(flow);
  String firstState=null;
  for (Iterator iter=flow.getStates().iterator(); iter.hasNext(); ) {
    State state=(State)iter.next();
    if (firstState == null) {
      firstState=state.getId();
    }
    if (state.isActionState()) {
      AnnotatedAction action=null;
      if (state.getAction() != null) {
        action=new AnnotatedAction(state.getAction());
      }
 else       if (state.getActionClass() != null) {
        Action tmpAction=null;
        if (Action.class.isAssignableFrom(state.getActionClass())) {
          tmpAction=(Action)BeanUtils.instantiateClass(state.getActionClass());
        }
 else {
          throw new UnsupportedOperationException("None " + Action.class.getName() + " action classes are not yet supported!");
        }
        if (state.getActionProperties() != null) {
          BeanWrapper beanWrapper=new BeanWrapperImpl(tmpAction);
          for (Iterator iter2=state.getActionProperties().entrySet().iterator(); iter2.hasNext(); ) {
            Map.Entry entry=(Map.Entry)iter2.next();
            beanWrapper.setPropertyValue((String)entry.getKey(),entry.getValue());
          }
        }
        action=new AnnotatedAction(tmpAction);
      }
 else       if (state.getActionClosure() != null) {
        action=new AnnotatedAction(new ClosureAction(this.pageFlowClass.getFlowId(),state.getId(),state.getActionClosure()));
      }
 else       if (state.getActionFormDetails() != null) {
        FormAction formAction=new FormAction();
        BeanWrapper beanWrapper=new BeanWrapperImpl(formAction);
        for (Iterator iter2=state.getActionFormDetails().entrySet().iterator(); iter2.hasNext(); ) {
          Map.Entry entry=(Map.Entry)iter2.next();
          beanWrapper.setPropertyValue((String)entry.getKey(),entry.getValue());
        }
        formAction.afterPropertiesSet();
        action=new AnnotatedAction(formAction);
        if (state.getActionMethod() != null) {
          action.setProperty(METHOD,state.getActionMethod());
        }
      }
 else {
        throw new UnsupportedOperationException();
      }
      addActionState(state.getId(),action,getTransitions(state.getTransitions()));
    }
 else     if (state.isViewState()) {
      if (state.getViewName() != null) {
        addViewState(state.getId(),new ModelViewDescriptorCreator(state.getViewName(),state.getViewModel()),getTransitions(state.getTransitions()),new HashMap());
      }
 else       if (state.getViewClosure() != null) {
        throw new UnsupportedOperationException("View closures are not yet supported!");
      }
    }
 else     if (state.isDecisionState()) {
      throw new UnsupportedOperationException("Decision states are not yet supported!");
    }
 else     if (state.isSubflowState()) {
      throw new UnsupportedOperationException("Subflow states are not yet supported!");
    }
 else {
      throw new UnsupportedOperationException();
    }
  }
  if (firstState != null) {
    getFlow().setStartState(firstState);
  }
}
