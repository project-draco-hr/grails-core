{
  Map dispatchParams=webRequest.getParams();
  String encoding=webRequest.getRequest().getCharacterEncoding();
  if (encoding == null)   encoding="UTF-8";
  Collection keys=params.keySet();
  keys=DefaultGroovyMethods.toList(keys);
  Collections.sort((List)keys,new Comparator(){
    public int compare(    Object leftKey,    Object rightKey){
      Object leftValue=params.get(leftKey);
      Object rightValue=params.get(rightKey);
      boolean leftIsClosure=leftValue instanceof Closure;
      boolean rightIsClosure=rightValue instanceof Closure;
      if (leftIsClosure && rightIsClosure)       return 0;
      if (leftIsClosure && !rightIsClosure)       return 1;
      if (rightIsClosure && !leftIsClosure)       return -1;
      return 0;
    }
  }
);
  for (  Object key : keys) {
    String name=(String)key;
    Object param=this.params.get(name);
    if (param instanceof Closure) {
      param=evaluateNameForValue(param);
    }
    if (param instanceof String) {
      try {
        param=URLDecoder.decode((String)param,encoding);
      }
 catch (      UnsupportedEncodingException e) {
        param=evaluateNameForValue(param);
      }
    }
    dispatchParams.put(name,param);
  }
  final String viewName=getViewName();
  if (viewName == null && getURI() == null) {
    webRequest.setControllerName(getControllerName());
    webRequest.setActionName(getActionName());
  }
  String id=getId();
  if (!StringUtils.isBlank(id))   try {
    dispatchParams.put(GrailsWebRequest.ID_PARAMETER,URLDecoder.decode(id,encoding));
  }
 catch (  UnsupportedEncodingException e) {
    dispatchParams.put(GrailsWebRequest.ID_PARAMETER,id);
  }
}
