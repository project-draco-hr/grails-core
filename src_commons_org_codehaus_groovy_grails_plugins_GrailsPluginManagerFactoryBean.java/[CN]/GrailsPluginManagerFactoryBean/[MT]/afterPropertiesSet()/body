{
  this.pluginManager=PluginManagerHolder.getPluginManager();
  if (pluginManager == null) {
    if (descriptor == null)     throw new IllegalStateException("Cannot create PluginManager, /WEB-INF/grails.xml not found!");
    GroovyClassLoader classLoader=application.getClassLoader();
    List classes=new ArrayList();
    SAXReader reader=new SAXReader();
    InputStream inputStream=null;
    try {
      inputStream=descriptor.getInputStream();
      Document doc=reader.read(inputStream);
      List grailsClasses=doc.selectNodes("/grails/plugins/plugin");
      for (Iterator i=grailsClasses.iterator(); i.hasNext(); ) {
        Node node=(Node)i.next();
        final String pluginName=node.getText();
        classes.add(classLoader.loadClass(pluginName));
      }
    }
  finally {
      if (inputStream != null)       inputStream.close();
    }
    Class[] loadedPlugins=(Class[])classes.toArray(new Class[classes.size()]);
    pluginManager=new DefaultGrailsPluginManager(loadedPlugins,application);
    pluginManager.setApplicationContext(applicationContext);
    PluginManagerHolder.setPluginManager(pluginManager);
    pluginManager.loadPlugins();
  }
  this.pluginManager.setApplication(application);
  this.pluginManager.doArtefactConfiguration();
  application.initialise();
}
