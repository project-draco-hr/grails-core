{
  if (isWindows()) {
    try {
      return PatchedJLineWindowsTerminal.setupTerminal(reader);
    }
 catch (    Exception ex) {
      error(ex);
    }
  }
 else {
    terminal=Terminal.setupTerminal();
  }
  return terminal;
}
