{
  if (grailsApplication != null) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("[GrailsAnnotationConfiguration] Setting context class loader to Grails GroovyClassLoader");
    }
    Thread.currentThread().setContextClassLoader(grailsApplication.getClassLoader());
  }
  addFilterDefinition(new FilterDefinition("dynamicFilterEnabler","1=1",Collections.emptyMap()));
  SessionFactory sessionFactory=super.buildSessionFactory();
  if (grailsApplication != null) {
    GrailsHibernateUtil.configureHibernateDomainClasses(sessionFactory,grailsApplication);
  }
  return sessionFactory;
}
