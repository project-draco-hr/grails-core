{
  try {
    Object o=GrailsClassUtils.getStaticPropertyValue(domainClass.getClazz(),GrailsDomainClassProperty.MAPPING);
    if (o != null || defaultMapping != null) {
      HibernateMappingBuilder builder=new HibernateMappingBuilder(domainClass.getFullName());
      GrailsApplication application=domainClass.getGrailsApplication();
      ApplicationContext ctx=null;
      if (application != null) {
        ctx=application.getMainContext();
        if (ctx == null)         ctx=application.getParentContext();
      }
      Mapping m=null;
      if (defaultMapping != null) {
        m=builder.evaluate(defaultMapping,ctx);
      }
      if (o instanceof Closure) {
        m=builder.evaluate((Closure<?>)o,ctx);
      }
      final Object identity=m.getIdentity();
      if (identity instanceof Identity) {
        final Identity identityObject=(Identity)identity;
        final String idName=identityObject.getName();
        if (idName != null && !GrailsDomainClassProperty.IDENTITY.equals(idName)) {
          GrailsDomainClassProperty persistentProperty=domainClass.getPersistentProperty(idName);
          if (!persistentProperty.isIdentity()) {
            if (persistentProperty instanceof DefaultGrailsDomainClassProperty) {
              ((DefaultGrailsDomainClassProperty)persistentProperty).setIdentity(true);
            }
          }
        }
      }
      trackCustomCascadingSaves(m,domainClass.getPersistentProperties());
      if (cache) {
        MAPPING_CACHE.put(domainClass.getClazz(),m);
      }
      return m;
    }
    return null;
  }
 catch (  Exception e) {
    throw new GrailsDomainException("Error evaluating ORM mappings block for domain [" + domainClass.getFullName() + "]:  "+ e.getMessage(),e);
  }
}
