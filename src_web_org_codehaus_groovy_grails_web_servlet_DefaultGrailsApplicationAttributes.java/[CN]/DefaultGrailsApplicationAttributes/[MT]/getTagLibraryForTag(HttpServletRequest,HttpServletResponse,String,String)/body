{
  Map tagCache=(Map)request.getAttribute(TAG_CACHE);
  String nonNullNamesapce=namespace == null ? GroovyPage.DEFAULT_NAMESPACE : namespace;
  String fullTagName=nonNullNamesapce + ":" + tagName;
  if (tagCache == null) {
    tagCache=new HashMap();
    request.setAttribute(TAG_CACHE,tagCache);
  }
  if (tagCache.containsKey(fullTagName)) {
    return (GroovyObject)tagCache.get(fullTagName);
  }
 else {
    GrailsTagLibClass tagLibClass=(GrailsTagLibClass)getGrailsApplication().getArtefactForFeature(TagLibArtefactHandler.TYPE,fullTagName);
    if (tagLibClass == null)     return null;
    GroovyObject tagLib=(GroovyObject)getApplicationContext().getBean(tagLibClass.getFullName());
    LOG.debug("Tag lib of the class was retrieved:" + tagLib.getClass().getName());
    tagCache.put(fullTagName,tagLib);
    return tagLib;
  }
}
