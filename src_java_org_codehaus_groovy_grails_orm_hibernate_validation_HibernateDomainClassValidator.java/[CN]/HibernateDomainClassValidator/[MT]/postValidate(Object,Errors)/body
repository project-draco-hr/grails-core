{
  if (applicationContext == null || !applicationContext.containsBean("sessionFactory")) {
    return;
  }
  try {
    SessionFactory sf=(SessionFactory)applicationContext.getBean("sessionFactory");
    if (errors.hasErrors()) {
      GrailsHibernateUtil.setObjectToReadyOnly(obj,sf);
      List<Object> invalidInstances=validatedInstances.get();
      for (      Object instance : invalidInstances) {
        GrailsHibernateUtil.setObjectToReadyOnly(instance,sf);
      }
    }
 else {
      GrailsHibernateUtil.setObjectToReadWrite(obj,sf);
    }
  }
  finally {
    List<Object> validatedInstancesList=validatedInstances.get();
    if (validatedInstancesList != null) {
      validatedInstancesList.clear();
    }
  }
}
