{
  if (!Boolean.parseBoolean(System.getProperty("grails.full.stacktrace"))) {
    StackTraceElement[] trace=t.getStackTrace();
    List newTrace=new ArrayList();
    for (int i=0; i < trace.length; i++) {
      StackTraceElement stackTraceElement=trace[i];
      if (isApplicationClass(stackTraceElement.getClassName())) {
        newTrace.add(stackTraceElement);
      }
    }
    if (newTrace.size() > 0) {
      STACK_LOG.error("Sanitizing stacktrace:",t);
      StackTraceElement[] clean=new StackTraceElement[newTrace.size()];
      newTrace.toArray(clean);
      t.setStackTrace(clean);
    }
  }
  return t;
}
