{
  Class type=bean.getPropertyType(propertyName);
  if (type == null) {
    Object target=bean.getWrappedInstance();
    String path=propertyName.replaceAll("\\[.+?\\]","");
    if (path.indexOf(PATH_SEPARATOR) > -1) {
      target=bean.getPropertyValue(StringUtils.substringBeforeLast(propertyName,"."));
      path=StringUtils.substringAfterLast(path,".");
    }
    type=getReferencedTypeForCollection(path,target);
  }
  return type;
}
