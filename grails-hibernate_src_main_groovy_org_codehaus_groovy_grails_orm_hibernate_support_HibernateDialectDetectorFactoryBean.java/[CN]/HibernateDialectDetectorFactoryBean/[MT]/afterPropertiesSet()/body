{
  Assert.notNull(dataSource,"Data source is not set!");
  Assert.notNull(vendorNameDialectMappings,"Vendor name/dialect mappings are not set!");
  String dbName=(String)JdbcUtils.extractDatabaseMetaData(dataSource,"getDatabaseProductName");
  Integer majorVersion=(Integer)JdbcUtils.extractDatabaseMetaData(dataSource,"getDatabaseMajorVersion");
  try {
    hibernateDialect=DialectFactory.determineDialect(dbName,majorVersion.intValue());
    hibernateDialectClassName=hibernateDialect.getClass().getName();
  }
 catch (  HibernateException e) {
    hibernateDialectClassName=vendorNameDialectMappings.getProperty(dbName);
  }
  if (StringUtils.isBlank(hibernateDialectClassName)) {
    throw new CouldNotDetermineHibernateDialectException("Could not determine Hibernate dialect for database name [" + dbName + "]!");
  }
}
