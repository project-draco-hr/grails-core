{
  if (this.dataSource == null) {
    throw new IllegalStateException("Data source is not set!");
  }
  if (this.vendorNameDialectMappings == null) {
    throw new IllegalStateException("Vendor name/dialect mappings are not set!");
  }
  String dbName=(String)JdbcUtils.extractDatabaseMetaData(this.dataSource,"getDatabaseProductName");
  Integer majorVersion=(Integer)JdbcUtils.extractDatabaseMetaData(this.dataSource,"getDatabaseMajorVersion");
  try {
    this.hibernateDialect=DialectFactory.determineDialect(dbName,majorVersion.intValue());
    this.hibernateDialectClassName=this.hibernateDialect.getClass().getName();
  }
 catch (  HibernateException e) {
    this.hibernateDialectClassName=this.vendorNameDialectMappings.getProperty(dbName);
  }
  if (StringUtils.isBlank(this.hibernateDialectClassName)) {
    throw new CouldNotDetermineHibernateDialectException("Could not determine Hibernate dialect for database name [" + dbName + "]!");
  }
}
