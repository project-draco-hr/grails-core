{
  GrailsControllerClass controllerClass=ga.getController(name);
  if (controllerClass == null)   throw new IllegalArgumentException("Controller not found for name " + name);
  GroovyObject mockController=(GroovyObject)controllerClass.newInstance();
  MockServletContext servletContext=new MockServletContext();
  MockApplicationContext appContext=new MockApplicationContext();
  appContext.registerMockBean("grailsApplication",ga);
  this.messageSource=new StaticMessageSource();
  appContext.registerMockBean("messageSource",this.messageSource);
  servletContext.setAttribute(GrailsApplicationAttributes.APPLICATION_CONTEXT,appContext);
  GrailsControllerHelper helper=new SimpleGrailsControllerHelper(ga,appContext,servletContext);
  HttpServletRequest request=new MockHttpServletRequest(servletContext);
  request.setAttribute(GrailsApplicationAttributes.CONTROLLER,mockController);
  request.setAttribute(DispatcherServlet.LOCALE_RESOLVER_ATTRIBUTE,new AcceptHeaderLocaleResolver());
  HttpServletResponse response=new MockHttpServletResponse();
  new ControllerDynamicMethods(mockController,helper,request,response);
  mockController.setProperty("controllerUri","/" + controllerClass.getLogicalPropertyName());
  return mockController;
}
