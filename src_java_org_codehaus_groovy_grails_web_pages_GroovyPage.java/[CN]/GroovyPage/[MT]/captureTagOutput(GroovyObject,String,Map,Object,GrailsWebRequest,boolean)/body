{
  Closure actualBody=createTagOutputCapturingClosure(tagLib,body,webRequest);
  final GroovyPageTagWriter out=new GroovyPageTagWriter();
  try {
    GroovyPageOutputStack.currentStack().push(out);
    Object tagLibProp=tagLib.getProperty(methodName);
    if (tagLibProp instanceof Closure) {
      Closure tag=(Closure)((Closure)tagLibProp).clone();
      Object bodyResult=null;
      if (tag.getParameterTypes().length == 1) {
        bodyResult=tag.call(new Object[]{attrs});
        if (actualBody != null && actualBody != EMPTY_BODY_CLOSURE) {
          Object bodyResult2=actualBody.call();
          if (bodyResult == null) {
            bodyResult=bodyResult2;
          }
        }
      }
 else       if (tag.getParameterTypes().length == 2) {
        bodyResult=tag.call(new Object[]{attrs,actualBody});
      }
 else {
        throw new GrailsTagException("Tag [" + methodName + "] does not specify expected number of params in tag library ["+ tagLib.getClass().getName()+ "]");
      }
      StreamCharBuffer buffer=out.getBuffer();
      if (buffer.charsAvailable() == 0 && bodyResult != null && !(bodyResult instanceof Writer)) {
        return bodyResult;
      }
      return buffer.toString();
    }
 else {
      throw new GrailsTagException("Tag [" + methodName + "] does not exist in tag library ["+ tagLib.getClass().getName()+ "]");
    }
  }
  finally {
    GroovyPageOutputStack.currentStack().pop();
  }
}
