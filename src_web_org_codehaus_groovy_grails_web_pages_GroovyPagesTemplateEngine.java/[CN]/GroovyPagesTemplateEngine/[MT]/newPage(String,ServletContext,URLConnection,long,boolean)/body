{
  Parse parse=new Parse(uri,groovyScriptConn.getInputStream());
  InputStream in=parse.parse();
  PageMeta pageMeta=new PageMeta();
  pageMeta.contentType=parse.getContentType();
  pageMeta.lineNumbers=parse.getLineNumberMatrix();
  if (spillGroovy) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Show source enabled, display generated GSP source...");
    }
    pageMeta.groovySource=in;
    return pageMeta;
  }
  Loader loader=new Loader(classLoader,context,uri,pageMeta.dependencies);
  Class scriptClass;
  try {
    scriptClass=loader.parseClass(in,uri.substring(1));
  }
 catch (  CompilationFailedException e) {
    LOG.error("Compilation error compiling GSP [" + uri + "]:"+ e.getMessage(),e);
    throw new ServletException("Could not parse script: " + uri,e);
  }
  pageMeta.servletScriptClass=scriptClass;
  pageMeta.lastModified=lastModified;
  pageCache.put(uri,pageMeta);
  return pageMeta;
}
