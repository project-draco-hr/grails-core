{
  if (!location.startsWith(SLASH))   location=SLASH + location;
  if (!location.startsWith(GrailsResourceUtils.WEB_INF)) {
    return GrailsResourceUtils.WEB_APP_DIR + location;
  }
  final String noWebInf=location.substring(GrailsResourceUtils.WEB_INF.length() + 1);
  final String defaultPath="file:" + baseLocation + SLASH+ noWebInf;
  if (!noWebInf.startsWith(PLUGINS_PREFIX)) {
    return defaultPath;
  }
  if (application != null) {
    GrailsPluginManager pluginManager=getPluginManager(application.getMainContext());
    if (pluginManager != null) {
      BuildSettings settings=pluginManager.getBuildSettings();
      PluginBuildSettings pluginBuildSettings=pluginManager.getPluginBuildSettings();
      String pluginPath=StringUtils.substringAfter(noWebInf,SLASH);
      String pluginName=StringUtils.substringBefore(pluginPath,SLASH);
      String remainingPath=StringUtils.substringAfter(pluginPath,SLASH);
      Resource r=pluginBuildSettings.getPluginDirForName(pluginName);
      if (r != null) {
        try {
          return "file:" + r.getFile().getAbsolutePath() + SLASH+ remainingPath;
        }
 catch (        IOException e) {
          return defaultPath;
        }
      }
      if (settings != null) {
        return "file:" + settings.getProjectPluginsDir().getAbsolutePath() + SLASH+ pluginName+ SLASH+ remainingPath;
      }
    }
  }
  return defaultPath;
}
