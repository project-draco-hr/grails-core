{
  Class groovyClass=cl.parseClass("public class CriteriaBuilderTestClass {\n" + "\n" + "\tList optionals = [ \"age\",'parent' ];\n"+ "\t\n"+ "\tLong id; \n"+ "\tLong version; \n"+ "\tdef relatesToMany = [children:CriteriaBuilderTestClass]; \n"+ "\t\n"+ "\tString firstName; \n"+ "\tString lastName; \n"+ "\tInteger age;\n"+ "\tSet children;\n"+ "\tCriteriaBuilderTestClass parent;\n"+ "\t\n"+ "\tstatic constraints = {\n"+ "\t\tfirstName(length:4..15)\n"+ "\t}\n"+ "}");
  grailsApplication=new DefaultGrailsApplication(new Class[]{groovyClass},cl);
  DefaultGrailsDomainConfiguration config=new DefaultGrailsDomainConfiguration();
  config.setGrailsApplication(this.grailsApplication);
  Properties props=new Properties();
  props.put("hibernate.connection.username","sa");
  props.put("hibernate.connection.password","");
  props.put("hibernate.connection.url","jdbc:hsqldb:mem:grailsDB");
  props.put("hibernate.connection.driver_class","org.hsqldb.jdbcDriver");
  props.put("hibernate.dialect","org.hibernate.dialect.HSQLDialect");
  props.put("hibernate.hbm2ddl.auto","create-drop");
  props.put("hibernate.show_sql","true");
  config.setProperties(props);
  Thread.currentThread().setContextClassLoader(this.cl);
  this.sessionFactory=config.buildSessionFactory();
  GrailsDomainConfigurationUtil.configureDynamicMethods(sessionFactory,grailsApplication);
  if (!TransactionSynchronizationManager.hasResource(this.sessionFactory)) {
    Session hibSession=this.sessionFactory.openSession();
    TransactionSynchronizationManager.bindResource(this.sessionFactory,new SessionHolder(hibSession));
  }
  super.onSetUp();
}
