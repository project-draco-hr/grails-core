{
  if (this.templateEngine == null)   throw new IllegalStateException("Property [templateEngine] cannot be null");
  ResourceLoader resourceLoader=establishResourceLoader();
  GrailsWebRequest webRequest=(GrailsWebRequest)RequestContextHolder.currentRequestAttributes();
  GrailsHttpServletRequest request=webRequest.getCurrentRequest();
  GroovyObject controller=webRequest.getAttributes().getController(request);
  GrailsApplication application=webRequest.getAttributes().getGrailsApplication();
  String gspView=resolveViewForController(controller,application,viewName,resourceLoader);
  Resource res=resourceLoader.getResource(gspView);
  if (res.exists()) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Resolved GSP view at URI [" + gspView + "]");
    }
    GroovyPageView gspSpringView=new GroovyPageView();
    gspSpringView.setUrl(gspView);
    gspSpringView.setTemplateEngine(templateEngine);
    return gspSpringView;
  }
 else {
    AbstractUrlBasedView view=buildView(viewName);
    view.setApplicationContext(getApplicationContext());
    view.afterPropertiesSet();
    return view;
  }
}
