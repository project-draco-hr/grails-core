{
  final ApplicationContext ctx=GrailsUtil.bootstrapGrailsFromClassPath();
  GrailsApplication app=(GrailsApplication)ctx.getBean(GrailsApplication.APPLICATION_ID);
  Binding b=new Binding();
  b.setVariable(GrailsApplication.APPLICATION_ID,app);
  b.setVariable("ctx",ctx);
  final groovy.ui.InteractiveShell shell=new groovy.ui.InteractiveShell(app.getClassLoader(),b,System.in,System.out,System.err);
  shell.setBeforeExecution(new Closure(shell){
    public Object doCall(){
      Map beans=ctx.getBeansOfType(PersistenceContextInterceptor.class);
      for (Iterator i=beans.values().iterator(); i.hasNext(); ) {
        PersistenceContextInterceptor interceptor=(PersistenceContextInterceptor)i.next();
        interceptor.init();
      }
      return null;
    }
  }
);
  shell.setAfterExecution(new Closure(shell){
    public Object doCall(){
      Map beans=ctx.getBeansOfType(PersistenceContextInterceptor.class);
      for (Iterator i=beans.values().iterator(); i.hasNext(); ) {
        PersistenceContextInterceptor interceptor=(PersistenceContextInterceptor)i.next();
        interceptor.flush();
        interceptor.destroy();
      }
      return null;
    }
  }
);
  shell.run();
}
