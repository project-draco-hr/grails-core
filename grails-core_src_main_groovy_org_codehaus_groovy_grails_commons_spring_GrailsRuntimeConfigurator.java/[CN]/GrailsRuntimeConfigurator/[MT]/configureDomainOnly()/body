{
  WebRuntimeSpringConfiguration springConfig=new WebRuntimeSpringConfiguration(parent,application.getClassLoader());
  springConfig.setServletContext(new MockServletContext());
  if (!pluginManager.isInitialised()) {
    pluginManager.loadPlugins();
  }
  if (pluginManager.hasGrailsPlugin("hibernate")) {
    pluginManager.doRuntimeConfiguration("hibernate",springConfig);
  }
 else   if (pluginManager.hasGrailsPlugin("hibernate4")) {
    pluginManager.doRuntimeConfiguration("hibernate4",springConfig);
  }
  WebApplicationContext ctx=(WebApplicationContext)springConfig.getApplicationContext();
  performPostProcessing(ctx);
  application.refreshConstraints();
  return ctx;
}
