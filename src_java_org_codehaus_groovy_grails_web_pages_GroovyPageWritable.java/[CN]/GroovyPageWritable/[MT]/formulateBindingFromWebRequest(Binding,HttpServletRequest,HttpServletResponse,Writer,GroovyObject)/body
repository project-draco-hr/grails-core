{
  GrailsWebRequest webRequest=GrailsWebRequest.lookup(request);
  binding.setVariable(GroovyPage.WEB_REQUEST,webRequest);
  binding.setVariable(GroovyPage.REQUEST,request);
  binding.setVariable(GroovyPage.RESPONSE,response);
  binding.setVariable(GroovyPage.FLASH,webRequest.getFlashScope());
  binding.setVariable(GroovyPage.SERVLET_CONTEXT,context);
  ApplicationContext appCtx=webRequest.getAttributes().getApplicationContext();
  binding.setVariable(GroovyPage.APPLICATION_CONTEXT,appCtx);
  if (appCtx != null) {
    GrailsApplication app=appCtx.getBean(GrailsApplication.APPLICATION_ID,GrailsApplication.class);
    binding.setVariable(GrailsApplication.APPLICATION_ID,app);
    Map<String,Class> domainClassesWithoutPackage=getDomainClassMap(app);
    final Map variables=binding.getVariables();
    variables.putAll(domainClassesWithoutPackage);
  }
  binding.setVariable(GroovyPage.SESSION,webRequest.getSession());
  binding.setVariable(GroovyPage.PARAMS,webRequest.getParams());
  binding.setVariable(GroovyPage.ACTION_NAME,webRequest.getActionName());
  binding.setVariable(GroovyPage.CONTROLLER_NAME,webRequest.getControllerName());
  if (controller != null) {
    binding.setVariable(GrailsApplicationAttributes.CONTROLLER,controller);
  }
  binding.setVariable(GroovyPage.OUT,out);
}
