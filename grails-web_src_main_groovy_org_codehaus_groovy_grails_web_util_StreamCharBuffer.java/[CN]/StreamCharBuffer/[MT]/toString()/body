{
  if (firstChunk == lastChunk && firstChunk instanceof StringChunk && allocBuffer.charsUsed() == 0 && ((StringChunk)firstChunk).isSingleBuffer()) {
    StringChunk strChunk=((StringChunk)firstChunk);
    return strChunk.str;
  }
  int initialReaderCount=readerCount;
  EncodingState encodingState=null;
  if (firstChunk != null) {
    encodingState=firstChunk.getEncodingState();
  }
 else {
    encodingState=allocBuffer.getEncodingState();
  }
  String str=readAsString();
  if (initialReaderCount == 0) {
    reset();
    if (str.length() > 0) {
      addChunk(new StringChunk(str,0,str.length())).setEncodingState(encodingState);
    }
  }
  if (encodingState != null && encodingState.getEncoders().size() > 0) {
    Encoder encoder=encodingState.getEncoders().iterator().next();
    if (encoder != null)     encoder.markEncoded(str);
  }
  return str;
}
