{
  if (elContext == null) {
    JspApplicationContext jspContext=JspFactory.getDefaultFactory().getJspApplicationContext(getServletContext());
    if (jspContext instanceof GroovyPagesJspApplicationContext) {
      elContext=((GroovyPagesJspApplicationContext)jspContext).createELContext(this);
      elContext.putContext(JspContext.class,this);
    }
 else {
      throw new IllegalStateException("Unable to create ELContext for a JspApplicationContext. It must be an instance of [org.codehaus.groovy.grails.web.pages.ext.jsp.GroovyPagesJspApplicationContext] do not override JspFactory.setDefaultFactory()!");
    }
  }
  return elContext;
}
