{
  StreamCharBuffer coded=new StreamCharBuffer(Math.min(Math.max(totalChunkSize,chunkSize) * 12 / 10,maxChunkSize));
  EncodedAppender codedWriter=(EncodedAppender)coded.getWriter();
  try {
    encodeTo(codedWriter,encoder);
  }
 catch (  IOException e) {
    log.error("IOException in StreamCharBuffer.encodeToBuffer",e);
  }
  return coded;
}
