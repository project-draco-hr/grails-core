{
  Object[] args=(Object[])arg;
  final boolean isResponseCode=isResponseCode(methodName);
  if (methodName.startsWith(SLASH) || isResponseCode) {
    try {
      urlDefiningMode=false;
      if (args.length > 0) {
        if (args[0] instanceof Closure) {
          UrlMappingData urlData;
          if (!isResponseCode) {
            urlData=urlParser.parse(methodName);
          }
 else {
            urlData=new ResponseCodeMappingData(methodName);
          }
          Closure callable=(Closure)args[0];
          if (delegate != null)           callable.setDelegate(delegate);
          callable.call();
          Object controllerName;
          Object actionName;
          if (binding != null) {
            controllerName=binding.getVariables().get(GrailsControllerClass.CONTROLLER);
            actionName=binding.getVariables().get(GrailsControllerClass.ACTION);
          }
 else {
            controllerName=this.controllerName;
            actionName=this.actionName;
          }
          ConstrainedProperty[] constraints=(ConstrainedProperty[])previousConstraints.toArray(new ConstrainedProperty[previousConstraints.size()]);
          UrlMapping urlMapping;
          if (!isResponseCode) {
            urlMapping=new RegexUrlMapping(urlData,controllerName,actionName,constraints);
          }
 else {
            urlMapping=new ResponseCodeUrlMapping(urlData,controllerName,actionName,constraints);
          }
          urlMappings.add(urlMapping);
          return urlMapping;
        }
        if (args[0] instanceof Map) {
          Map namedArguments=(Map)args[0];
          UrlMappingData urlData=urlParser.parse(methodName);
          if (args.length > 1 && args[1] instanceof Closure) {
            Closure callable=(Closure)args[1];
            callable.call();
          }
          return getURLMapping(namedArguments,urlData);
        }
      }
      throw new UrlMappingException("No controller or action defined for URL mapping [" + methodName + "]");
    }
  finally {
      if (binding != null) {
        binding.getVariables().remove(GrailsControllerClass.CONTROLLER);
        binding.getVariables().remove(GrailsControllerClass.ACTION);
      }
 else {
        controllerName=null;
        actionName=null;
      }
      previousConstraints.clear();
      urlDefiningMode=true;
    }
  }
 else   if (!urlDefiningMode && CONSTRAINTS.equals(methodName)) {
    ConstrainedPropertyBuilder builder=new ConstrainedPropertyBuilder(this);
    if (args.length > 0 && (args[0] instanceof Closure)) {
      Closure callable=(Closure)args[0];
      callable.setDelegate(builder);
      for (Iterator i=previousConstraints.iterator(); i.hasNext(); ) {
        ConstrainedProperty constrainedProperty=(ConstrainedProperty)i.next();
        builder.getConstrainedProperties().put(constrainedProperty.getPropertyName(),constrainedProperty);
      }
      callable.call();
    }
    return builder.getConstrainedProperties();
  }
 else {
    return super.invokeMethod(methodName,arg);
  }
}
