{
  if (target instanceof GrailsWrappedWriter) {
    GrailsWrappedWriter wrappedWriter=((GrailsWrappedWriter)target);
    if (wrappedWriter.isAllowUnwrappingOut()) {
      target=wrappedWriter.unwrap();
    }
 else     if (target instanceof GrailsPrintWriter && ((GrailsPrintWriter)target).getOut() instanceof EncodedAppenderWriter) {
      target=((GrailsPrintWriter)target).getOut();
    }
  }
  if (target instanceof StreamCharBufferWriter) {
    if (target == writer) {
      throw new IllegalArgumentException("Cannot write buffer to itself.");
    }
    ((StreamCharBufferWriter)target).write(this);
    return;
  }
 else   if (target instanceof EncodedAppenderFactory) {
    EncodedAppenderFactory eaw=(EncodedAppenderFactory)target;
    if (eaw.getEncodedAppender() == writer.getEncodedAppender()) {
      throw new IllegalArgumentException("Cannot write buffer to itself.");
    }
    if (eaw.getEncodedAppender().getClass() == StreamCharBufferEncodedAppender.class) {
      ((StreamCharBufferEncodedAppender)eaw.getEncodedAppender()).getWriter().write(this);
      return;
    }
 else     if (target instanceof EncoderAware) {
      encodeTo(eaw.getEncodedAppender(),((EncoderAware)eaw).getEncoder());
      if (emptyAfter) {
        emptyAfterReading();
      }
      if (flushTarget) {
        target.flush();
      }
      return;
    }
  }
  writeToImpl(target,flushTarget,emptyAfter);
}
