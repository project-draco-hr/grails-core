{
  GrailsApplication application=(GrailsApplication)parent.getBean(GrailsApplication.APPLICATION_ID);
  if (LOG.isDebugEnabled()) {
    LOG.debug("[GrailsContextLoader] Configurating Grails Application");
  }
  if (application.getParentContext() == null) {
    application.setApplicationContext(parent);
  }
  GrailsRuntimeConfigurator configurator;
  if (parent.containsBean(GrailsRuntimeConfigurator.BEAN_ID)) {
    configurator=(GrailsRuntimeConfigurator)parent.getBean(GrailsRuntimeConfigurator.BEAN_ID);
  }
 else {
    configurator=new GrailsRuntimeConfigurator(application,parent);
    if (parent.containsBean(GrailsPluginManager.BEAN_NAME)) {
      GrailsPluginManager pluginManager=(GrailsPluginManager)parent.getBean(GrailsPluginManager.BEAN_NAME);
      configurator.setPluginManager(pluginManager);
    }
  }
  servletContext.setAttribute(ApplicationAttributes.PLUGIN_MANAGER,configurator.getPluginManager());
  servletContext.setAttribute(ApplicationAttributes.PARENT_APPLICATION_CONTEXT,parent);
  servletContext.setAttribute(GrailsApplication.APPLICATION_ID,application);
  ServletContextHolder.setServletContext(servletContext);
  WebApplicationContext webContext=configurator.configure(servletContext);
  configurator.getPluginManager().setApplicationContext(webContext);
  servletContext.setAttribute(ApplicationAttributes.APPLICATION_CONTEXT,webContext);
  servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE,webContext);
  LOG.info("[GrailsContextLoader] Grails application loaded.");
  return webContext;
}
