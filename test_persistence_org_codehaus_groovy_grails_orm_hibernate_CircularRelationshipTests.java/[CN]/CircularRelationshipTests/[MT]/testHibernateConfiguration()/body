{
  assertNotNull(this.sessionFactory);
  GrailsClass[] domainClasses=grailsApplication.getArtefacts(DomainClassArtefactHandler.TYPE);
  assertEquals(1,domainClasses.length);
  GroovyObject obj=(GroovyObject)grailsApplication.getArtefact(DomainClassArtefactHandler.TYPE,"org.codehaus.groovy.grails.domain.CircularRelationship").newInstance();
  GroovyObject child=(GroovyObject)grailsApplication.getArtefact(DomainClassArtefactHandler.TYPE,"org.codehaus.groovy.grails.domain.CircularRelationship").newInstance();
  assertNotNull(obj);
  child.setProperty("parent",obj);
  Set children=new HashSet();
  children.add(child);
  obj.setProperty("children",children);
  obj.invokeMethod("save",new Object[0]);
  obj=(GroovyObject)obj.getMetaClass().invokeStaticMethod(obj,"get",new Object[]{new Long(1)});
  assertNotNull(obj.getProperty("children"));
  assertEquals(1,((Set)obj.getProperty("children")).size());
}
