{
  if (charBuffer == null) {
    if (byteBuffer != null) {
      throw new IllegalStateException("response.getWriter() called after response.getOutputStream()");
    }
    charBuffer=new StreamCharBuffer();
    if (gspSitemeshPage != null) {
      gspSitemeshPage.setPageBuffer(charBuffer);
    }
    exposedWriter=new GrailsPrintWriter(charBuffer.getWriter());
    exposedWriter.setFinalTargetHere(true);
  }
  return exposedWriter;
}
