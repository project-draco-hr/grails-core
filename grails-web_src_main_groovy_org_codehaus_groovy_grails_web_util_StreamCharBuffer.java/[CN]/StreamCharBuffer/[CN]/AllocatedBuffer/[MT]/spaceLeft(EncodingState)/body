{
  if (this.encodingState != null && (encodingState == null || !this.encodingState.equals(encodingState)) && hasChunk() && !isNotConnectedToEncoderAwareWriters()) {
    addChunk(allocBuffer.createChunk());
    this.encodingState=null;
  }
  nextEncoders=encodingState;
  return size - used;
}
