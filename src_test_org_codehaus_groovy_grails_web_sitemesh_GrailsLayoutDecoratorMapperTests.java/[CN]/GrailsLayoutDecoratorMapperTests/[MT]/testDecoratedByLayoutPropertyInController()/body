{
  GrailsWebRequest webRequest=GrailsWebUtil.bindMockWebRequest();
  MockApplicationContext appCtx=new MockApplicationContext();
  appCtx.registerMockBean(PluginMetaManager.BEAN_ID,new DefaultPluginMetaManager());
  appCtx.registerMockResource("WEB-INF/grails-app/views/layouts/test.gsp","<html><body><g:layoutBody /></body></html>");
  appCtx.registerMockResource("WEB-INF/grails-app/views/layouts/mylayout.gsp","<html><body><g:layoutBody /></body></html>");
  webRequest.getServletContext().setAttribute(GrailsApplicationAttributes.APPLICATION_CONTEXT,appCtx);
  webRequest.getServletContext().setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE,appCtx);
  MockHttpServletRequest request=new MockHttpServletRequest("GET","orders/list");
  ServletContext context=webRequest.getServletContext();
  GroovyClassLoader gcl=new GroovyClassLoader();
  GroovyObject controller=(GroovyObject)gcl.parseClass("class TestController {\n" + "def controllerName = 'test'\n" + "def actionUri = '/test/testAction'\n"+ "static layout = 'mylayout'\n"+ "}").newInstance();
  request.setAttribute(GrailsApplicationAttributes.CONTROLLER,controller);
  GrailsLayoutDecoratorMapper m=new GrailsLayoutDecoratorMapper();
  Config c=new Config(new MockServletConfig(context));
  m.init(c,null,null);
  HTMLPageParser parser=new HTMLPageParser();
  String html="<html><head><title>Test title</title></head><body>here is the body</body></html>";
  Page page=parser.parse(html.toCharArray());
  Decorator d=m.getDecorator(request,page);
  assertNotNull(d);
  assertEquals("/WEB-INF/grails-app/views/layouts/mylayout.gsp",d.getPage());
  assertEquals("mylayout",d.getName());
}
