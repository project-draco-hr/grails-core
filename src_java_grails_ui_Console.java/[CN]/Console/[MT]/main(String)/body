{
  final ApplicationContext ctx=GrailsUtil.bootstrapGrailsFromClassPath();
  GrailsApplication app=(GrailsApplication)ctx.getBean(GrailsApplication.APPLICATION_ID);
  Binding b=new Binding();
  b.setVariable(GrailsApplication.APPLICATION_ID,app);
  b.setVariable("ctx",ctx);
  Console c=new Console(app.getClassLoader(),b);
  c.setBeforeExecution(new Closure(c){
    private static final long serialVersionUID=4773257809080703257L;
    @SuppressWarnings("unused") public Object doCall(){
      Map beans=ctx.getBeansOfType(PersistenceContextInterceptor.class);
      for (Iterator i=beans.values().iterator(); i.hasNext(); ) {
        PersistenceContextInterceptor interceptor=(PersistenceContextInterceptor)i.next();
        interceptor.init();
      }
      return null;
    }
  }
);
  c.setAfterExecution(new Closure(c){
    private static final long serialVersionUID=7292229320100706377L;
    public Object doCall(){
      Map beans=ctx.getBeansOfType(PersistenceContextInterceptor.class);
      for (Iterator i=beans.values().iterator(); i.hasNext(); ) {
        PersistenceContextInterceptor interceptor=(PersistenceContextInterceptor)i.next();
        interceptor.flush();
        interceptor.destroy();
      }
      return null;
    }
    public Object call(){
      return doCall();
    }
    public Object call(    Object[] args){
      return doCall();
    }
    public Object call(    Object arguments){
      return doCall();
    }
  }
);
  c.run();
}
