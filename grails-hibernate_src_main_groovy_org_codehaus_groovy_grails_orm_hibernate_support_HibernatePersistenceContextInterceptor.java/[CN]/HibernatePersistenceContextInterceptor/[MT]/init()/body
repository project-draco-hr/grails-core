{
  if (incNestingCount() > 1) {
    return;
  }
  SessionFactory sf=getSessionFactory();
  if (TransactionSynchronizationManager.hasResource(sf)) {
    setParticipate(true);
  }
 else {
    setParticipate(false);
    LOG.debug("Opening single Hibernate session in HibernatePersistenceContextInterceptor");
    Session session=getSession();
    GrailsHibernateUtil.enableDynamicFilterEnablerIfPresent(sf,session);
    session.setFlushMode(FlushMode.AUTO);
    TransactionSynchronizationManager.bindResource(sf,new SessionHolder(session));
  }
}
