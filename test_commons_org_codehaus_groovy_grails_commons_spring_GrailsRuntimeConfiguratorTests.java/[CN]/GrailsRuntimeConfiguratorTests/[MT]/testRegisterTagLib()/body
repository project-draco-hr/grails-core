{
  GroovyClassLoader gcl=new GroovyClassLoader();
  GrailsApplication app=new DefaultGrailsApplication(new Class[0],gcl);
  MockApplicationContext parent=new MockApplicationContext();
  parent.registerMockBean(GrailsApplication.APPLICATION_ID,app);
  parent.registerMockBean(PluginMetaManager.BEAN_ID,new DefaultPluginMetaManager(new Resource[0]));
  GrailsRuntimeConfigurator conf=new GrailsRuntimeConfigurator(app,parent);
  GrailsApplicationContext ctx=(GrailsApplicationContext)conf.configure(new MockServletContext());
  assertNotNull(ctx);
  Class tag=gcl.parseClass("class TestTagLib { def myTag = { attrs -> } }");
  GrailsTagLibClass tagLibClass=(GrailsTagLibClass)app.addArtefact(TagLibArtefactHandler.TYPE,tag);
  GrailsRuntimeConfigurator.registerTagLibrary(tagLibClass,ctx);
  GroovyObject tagLib=(GroovyObject)ctx.getBean("TestTagLib");
  assertEquals(tag,tagLib.getClass());
  assertTrue(ctx.containsBean("TestTagLibTargetSource"));
  assertTrue(ctx.containsBean("TestTagLibProxy"));
}
