{
  if (str == null || len <= 0) {
    return;
  }
  if (encoder != null && (currentTags == null || !currentTags.hasTag(encoder.getCodecName()))) {
    EncodingTags newTags=(currentTags != null) ? currentTags.appendToNew(encoder) : EncodingTags.createNew(encoder);
    String source;
    if (off == 0 && len == str.length()) {
      source=str;
    }
 else {
      char[] buff=new char[len];
      str.getChars(off,off + len,buff,0);
      source=String.valueOf(buff);
    }
    String encoded=String.valueOf(encoder.encode(source));
    write(newTags,encoded,0,encoded.length());
  }
 else {
    write(currentTags,str,off,len);
  }
}
