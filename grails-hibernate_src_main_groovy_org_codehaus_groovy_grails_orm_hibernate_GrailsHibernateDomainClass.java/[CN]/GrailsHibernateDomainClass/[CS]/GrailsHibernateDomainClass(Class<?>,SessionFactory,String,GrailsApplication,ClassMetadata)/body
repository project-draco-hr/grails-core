{
  super(clazz,"");
  this.application=application;
  this.sessionFactory=sessionFactory;
  this.sessionFactoryName=sessionFactoryName;
  new StandardAnnotationMetadata(clazz);
  String ident=metaData.getIdentifierPropertyName();
  if (ident != null) {
    Class<?> identType=getPropertyType(ident);
    identifier=new GrailsHibernateDomainClassProperty(this,ident);
    identifier.setIdentity(true);
    identifier.setType(identType);
    propertyMap.put(ident,identifier);
  }
  final int versionIndex=metaData.getVersionProperty();
  String versionPropertyName=null;
  if (versionIndex > -1) {
    versionPropertyName=metaData.getPropertyNames()[versionIndex];
    version=new GrailsHibernateDomainClassProperty(this,versionPropertyName);
    version.setType(getPropertyType(versionPropertyName));
  }
  String[] propertyNames=metaData.getPropertyNames();
  for (  String propertyName : propertyNames) {
    if (!propertyName.equals(ident) && !(versionPropertyName != null && propertyName.equals(versionPropertyName))) {
      GrailsHibernateDomainClassProperty prop=new GrailsHibernateDomainClassProperty(this,propertyName);
      prop.setType(getPropertyType(propertyName));
      Type hibernateType=metaData.getPropertyType(propertyName);
      if (hibernateType.isAssociationType()) {
        prop.setAssociation(true);
        AssociationType assType=(AssociationType)hibernateType;
        if (assType instanceof AnyType) {
          continue;
        }
        try {
          String associatedEntity=assType.getAssociatedEntityName((SessionFactoryImplementor)sessionFactory);
          ClassMetadata associatedMetaData=sessionFactory.getClassMetadata(associatedEntity);
          prop.setRelatedClassType(associatedMetaData.getMappedClass(EntityMode.POJO));
        }
 catch (        MappingException me) {
          if (hibernateType.isCollectionType()) {
            prop.setRelatedClassType(Collection.class);
          }
        }
        if (hibernateType.isCollectionType()) {
          prop.setOneToMany(true);
        }
 else         if (hibernateType.isEntityType()) {
          prop.setManyToOne(true);
          prop.setOneToOne(true);
        }
      }
      propertyMap.put(propertyName,prop);
    }
  }
  properties=propertyMap.values().toArray(new GrailsDomainClassProperty[propertyMap.size()]);
  evaluateConstraints();
}
