{
  CompilationUnit cu=super.createCompilationUnit(config,source);
  GrailsAwareInjectionOperation operation;
  if (classInjectors == null) {
    operation=new GrailsAwareInjectionOperation();
  }
 else {
    operation=new GrailsAwareInjectionOperation(classInjectors);
  }
  cu.addPhaseOperation(operation,Phases.CANONICALIZATION);
  if (traitInjectors != null) {
    GrailsAwareTraitInjectionOperation grailsTraitInjector=new GrailsAwareTraitInjectionOperation(cu);
    grailsTraitInjector.setTraitInjectors(Arrays.asList(traitInjectors));
    cu.addPhaseOperation(grailsTraitInjector,Phases.SEMANTIC_ANALYSIS);
  }
  return cu;
}
