{
  Object[] args=(Object[])arg;
  String mappedURI=establishFullURI(methodName);
  final boolean isResponseCode=isResponseCode(mappedURI);
  if (mappedURI.startsWith(SLASH) || isResponseCode) {
    parameterValues=new HashMap<String,Object>();
    Map variables=binding != null ? binding.getVariables() : null;
    try {
      urlDefiningMode=false;
      args=args != null && args.length > 0 ? args : new Object[]{Collections.EMPTY_MAP};
      if (args[0] instanceof Closure) {
        UrlMappingData urlData=createUrlMappingData(mappedURI,isResponseCode);
        Closure callable=(Closure)args[0];
        if (delegate != null) {
          callable.setDelegate(delegate);
        }
        callable.call();
        Object controllerName;
        Object actionName;
        Object pluginName;
        String httpMethod=null;
        String version=null;
        Object namespace;
        Object viewName;
        Object uri;
        if (binding != null) {
          controllerName=variables.get(GrailsControllerClass.CONTROLLER);
          actionName=variables.get(GrailsControllerClass.ACTION);
          viewName=variables.get(GrailsControllerClass.VIEW);
          uri=variables.get(UrlMapping.URI);
          pluginName=variables.get(UrlMapping.PLUGIN);
          namespace=variables.get(UrlMapping.NAMESPACE);
          if (variables.containsKey(UrlMapping.HTTP_METHOD)) {
            httpMethod=variables.get(UrlMapping.HTTP_METHOD).toString();
          }
        }
 else {
          controllerName=this.controllerName;
          actionName=this.actionName;
          pluginName=this.pluginName;
          namespace=this.namespace;
          viewName=this.viewName;
          uri=this.uri;
          httpMethod=this.httpMethod;
        }
        ConstrainedProperty[] constraints=getCurrentConstraints().toArray(new ConstrainedProperty[getCurrentConstraints().size()]);
        UrlMapping urlMapping;
        if (uri != null) {
          try {
            urlMapping=new RegexUrlMapping(urlData,new URI(uri.toString()),constraints,sc);
          }
 catch (          URISyntaxException e) {
            throw new UrlMappingException("Cannot map to invalid URI: " + e.getMessage(),e);
          }
        }
 else {
          urlMapping=createURLMapping(urlData,isResponseCode,controllerName,actionName,namespace,pluginName,viewName,httpMethod,version,constraints);
        }
        if (binding != null) {
          Map bindingVariables=variables;
          Object parse=getParseRequest(Collections.EMPTY_MAP,bindingVariables);
          if (parse instanceof Boolean) {
            urlMapping.setParseRequest((Boolean)parse);
          }
        }
        configureUrlMapping(urlMapping);
        return urlMapping;
      }
      if (args[0] instanceof Map) {
        Map namedArguments=(Map)args[0];
        String uri=mappedURI;
        String version=null;
        if (namedArguments.containsKey(UrlMapping.VERSION)) {
          version=namedArguments.get(UrlMapping.VERSION).toString();
        }
        UrlMappingData urlData=createUrlMappingData(uri,isResponseCode);
        if (namedArguments.containsKey(RESOURCE)) {
          Object controller=namedArguments.get(RESOURCE);
          String controllerName=controller.toString();
          parentResources.push(new ParentResource(controllerName,uri,getCurrentConstraints(),true));
          try {
            invokeLastArgumentIfClosure(args);
          }
  finally {
            parentResources.pop();
          }
          if (controller != null) {
            createSingleResourceRestfulMappings(controllerName,pluginName,namespace,version,urlData,getCurrentConstraints(),calculateIncludes(namedArguments,DEFAULT_RESOURCE_INCLUDES));
          }
        }
 else         if (namedArguments.containsKey(RESOURCES)) {
          Object controller=namedArguments.get(RESOURCES);
          String controllerName=controller.toString();
          parentResources.push(new ParentResource(controllerName,uri,getCurrentConstraints(),false));
          try {
            invokeLastArgumentIfClosure(args);
          }
  finally {
            parentResources.pop();
          }
          if (controller != null) {
            createResourceRestfulMappings(controllerName,pluginName,namespace,version,urlData,getCurrentConstraints(),calculateIncludes(namedArguments,DEFAULT_RESOURCES_INCLUDES));
          }
        }
 else {
          invokeLastArgumentIfClosure(args);
          UrlMapping urlMapping=getURLMappingForNamedArgs(namedArguments,urlData,mappedURI,isResponseCode);
          configureUrlMapping(urlMapping);
          return urlMapping;
        }
      }
      return null;
    }
  finally {
      if (binding != null) {
        variables.clear();
      }
 else {
        controllerName=null;
        actionName=null;
        viewName=null;
        pluginName=null;
        namespace=null;
      }
      if (parentResources.isEmpty()) {
        previousConstraints.clear();
        urlDefiningMode=true;
      }
    }
  }
 else   if (!urlDefiningMode && CONSTRAINTS.equals(mappedURI)) {
    ConstrainedPropertyBuilder builder=new ConstrainedPropertyBuilder(this);
    if (args.length > 0 && (args[0] instanceof Closure)) {
      Closure callable=(Closure)args[0];
      callable.setDelegate(builder);
      for (      ConstrainedProperty constrainedProperty : getCurrentConstraints()) {
        builder.getConstrainedProperties().put(constrainedProperty.getPropertyName(),constrainedProperty);
      }
      callable.call();
    }
    return builder.getConstrainedProperties();
  }
 else {
    return super.invokeMethod(mappedURI,arg);
  }
}
