{
  if (persistentProperty.isEmbedded()) {
    return persistentProperty.getComponent();
  }
 else {
    if (grailsApplication != null) {
      String associatedObjectType=associatedObject.getClass().getName();
      if (associatedObject instanceof HibernateProxy) {
        associatedObjectType=((HibernateProxy)associatedObject).getHibernateLazyInitializer().getEntityName();
      }
      return (GrailsDomainClass)grailsApplication.getArtefact(DomainClassArtefactHandler.TYPE,associatedObjectType);
    }
 else     return persistentProperty.getReferencedDomainClass();
  }
}
