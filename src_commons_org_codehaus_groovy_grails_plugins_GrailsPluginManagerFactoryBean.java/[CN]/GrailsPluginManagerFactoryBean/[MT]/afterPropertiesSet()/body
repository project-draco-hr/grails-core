{
  this.pluginManager=PluginManagerHolder.getPluginManager();
  if (pluginManager == null) {
    if (descriptor == null)     throw new IllegalStateException("Cannot create PluginManager, /WEB-INF/grails.xml not found!");
    GroovyClassLoader classLoader=application.getClassLoader();
    List classes=new ArrayList();
    InputStream inputStream=null;
    try {
      inputStream=descriptor.getInputStream();
      SAXReader reader=new SAXReader();
      XPath xpath=DocumentHelper.createXPath("/grails/plugins/plugin");
      List nodes=xpath.selectNodes(reader.read(inputStream));
      for (int i=0; i < nodes.size(); i++) {
        Element node=(Element)nodes.get(i);
        final String pluginName=node.getText();
        classes.add(classLoader.loadClass(pluginName));
      }
    }
  finally {
      if (inputStream != null)       inputStream.close();
    }
    Class[] loadedPlugins=(Class[])classes.toArray(new Class[classes.size()]);
    pluginManager=new DefaultGrailsPluginManager(loadedPlugins,application);
    pluginManager.setApplicationContext(applicationContext);
    PluginManagerHolder.setPluginManager(pluginManager);
    pluginManager.loadPlugins();
  }
  this.pluginManager.setApplication(application);
  this.pluginManager.doArtefactConfiguration();
  application.initialise();
}
