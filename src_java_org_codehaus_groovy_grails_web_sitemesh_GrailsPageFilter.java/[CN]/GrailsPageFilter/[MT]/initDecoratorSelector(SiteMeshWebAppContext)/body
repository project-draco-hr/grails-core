{
  final Factory factory=Factory.getInstance(new Config(filterConfig));
  factory.refresh();
  return new DecoratorMapper2DecoratorSelector(factory.getDecoratorMapper()){
    public Decorator selectDecorator(    Content content,    SiteMeshContext context){
      SiteMeshWebAppContext webAppContext=(SiteMeshWebAppContext)context;
      final com.opensymphony.module.sitemesh.Decorator decorator=factory.getDecoratorMapper().getDecorator(webAppContext.getRequest(),content2htmlPage(content));
      if (decorator == null || decorator.getPage() == null) {
        return new NoDecorator();
      }
 else {
        return new OldDecorator2NewDecorator(decorator){
          protected void render(          Content content,          HttpServletRequest request,          HttpServletResponse response,          ServletContext servletContext,          SiteMeshWebAppContext webAppContext) throws IOException, ServletException {
            HTMLPage htmlPage=content2htmlPage(content);
            request.setAttribute(PAGE,htmlPage);
            if (decorator.getURIPath() != null) {
              if (servletContext.getContext(decorator.getURIPath()) != null) {
                servletContext=servletContext.getContext(decorator.getURIPath());
              }
            }
            RequestDispatcher dispatcher=servletContext.getRequestDispatcher(decorator.getPage());
            if (response.isCommitted()) {
              dispatcher.include(request,response);
            }
 else {
              dispatcher.forward(request,response);
            }
            request.removeAttribute(PAGE);
          }
        }
;
      }
    }
  }
;
}
