{
  final boolean[] created=new boolean[1];
  final boolean[] sessionEnded=new boolean[1];
  final State[] stateEntered=new State[1];
  created[0]=false;
  sessionEnded[0]=false;
  ViewDescriptor viewDescriptor=super.handle(request,response,new FlowExecutionListener(){
    public void created(    FlowExecutionContext context){
      created[0]=true;
    }
    public void sessionStarted(    RequestContext context){
    }
    public void resumed(    RequestContext context){
    }
    public void sessionEnded(    RequestContext context,    FlowSession endedSession){
      sessionEnded[0]=true;
    }
    public void stateEntered(    RequestContext context,    State previousState,    State state){
      stateEntered[0]=state;
    }
    public void eventSignaled(    RequestContext context){
    }
    public void requestProcessed(    RequestContext context){
    }
    public void loaded(    FlowExecutionContext context,    Serializable id){
    }
    public void paused(    RequestContext context){
    }
    public void removed(    FlowExecutionContext context,    Serializable id){
    }
    public void requestSubmitted(    RequestContext context){
    }
    public void saved(    FlowExecutionContext context,    Serializable id){
    }
    public void sessionStarting(    RequestContext context,    State startState,    Map input) throws EnterStateVetoException {
    }
    public void stateEntering(    RequestContext context,    State nextState) throws EnterStateVetoException {
    }
  }
);
  if (viewDescriptor == null) {
    throw new NoViewDefinedException("No view defined for state [" + stateEntered[0].getId() + "]!");
  }
  Cookie flowExecutionIdCookie=null;
  if (sessionEnded[0] || (request.getAttribute(RESET_PARAMETER) != null && request.getAttribute(RESET_PARAMETER).equals(TRUE))) {
    flowExecutionIdCookie=new Cookie(FLOW_EXECUTION_ID_COOKIE_NAME,"");
  }
 else   if (created[0]) {
    flowExecutionIdCookie=new Cookie(FLOW_EXECUTION_ID_COOKIE_NAME,(String)viewDescriptor.getAttribute(FLOW_EXECUTION_ID_ATTRIBUTE));
  }
  if (flowExecutionIdCookie != null) {
    response.addCookie(flowExecutionIdCookie);
  }
  return viewDescriptor;
}
