{
  GrailsApplication application=(GrailsApplication)parent.getBean(GrailsApplication.APPLICATION_ID);
  if (LOG.isDebugEnabled()) {
    LOG.debug("[GrailsContextLoader] Configurating Grails Application");
  }
  GrailsRuntimeConfigurator configurator=new GrailsRuntimeConfigurator(application,parent);
  if (parent.containsBean(GrailsPluginManager.BEAN_NAME)) {
    GrailsPluginManager pluginManager=(GrailsPluginManager)parent.getBean(GrailsPluginManager.BEAN_NAME);
    configurator.setPluginManager(pluginManager);
  }
  servletContext.setAttribute(GrailsApplicationAttributes.PLUGIN_MANAGER,configurator.getPluginManager());
  servletContext.setAttribute(GrailsApplicationAttributes.PARENT_APPLICATION_CONTEXT,parent);
  servletContext.setAttribute(GrailsApplication.APPLICATION_ID,application);
  WebApplicationContext webContext=configurator.configure(servletContext);
  configurator.getPluginManager().setApplicationContext(webContext);
  servletContext.setAttribute(GrailsApplicationAttributes.APPLICATION_CONTEXT,webContext);
  LOG.info("[GrailsContextLoader] Grails application loaded.");
  return webContext;
}
