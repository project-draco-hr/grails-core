{
  session.getPersistenceContext().setFlushing(true);
  try {
    session.getJDBCContext().getConnectionManager().flushBeginning();
    session.getActionQueue().prepareActions();
    session.getActionQueue().executeActions();
  }
 catch (  HibernateException he) {
    LOG.error("Could not synchronize database state with session",he);
    throw he;
  }
 finally {
    session.getPersistenceContext().setFlushing(false);
    session.getJDBCContext().getConnectionManager().flushEnding();
  }
}
