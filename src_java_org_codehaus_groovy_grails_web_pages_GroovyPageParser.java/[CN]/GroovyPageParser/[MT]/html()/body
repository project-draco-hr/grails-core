{
  if (!finalPass)   return;
  if (LOG.isDebugEnabled())   LOG.debug("parse: html");
  String text=scan.getToken();
  if (text.length() == 0)   return;
  boolean contentIsWhitespace=!Pattern.compile("\\S").matcher(text).find();
  if (!contentIsWhitespace && currentlyBufferingWhitespace) {
    flushBufferedWhiteSpace();
  }
 else {
    currentlyBufferingWhitespace=contentIsWhitespace;
  }
  previousContentWasNonWhitespace=!contentIsWhitespace;
  String constantName=(String)constantsToNames.get(text);
  if (constantName == null) {
    constantName="htmlParts[" + (constantCount++) + "]";
    constantsToNames.put(text,constantName);
    htmlParts.add(text);
  }
  bufferedPrintlnToResponse(constantName);
}
