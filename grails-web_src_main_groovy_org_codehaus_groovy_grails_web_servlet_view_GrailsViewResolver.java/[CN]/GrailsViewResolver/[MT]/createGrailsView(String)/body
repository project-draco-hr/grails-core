{
  GrailsWebRequest webRequest=WebUtils.retrieveGrailsWebRequest();
  HttpServletRequest request=webRequest.getCurrentRequest();
  GroovyObject controller=webRequest.getAttributes().getController(request);
  if (grailsApplication == null) {
    grailsApplication=getApplicationContext().getBean(GrailsApplication.APPLICATION_ID,GrailsApplication.class);
  }
  ResourceLoader loader=establishResourceLoader(grailsApplication);
  String format=request.getAttribute(GrailsApplicationAttributes.CONTENT_FORMAT) != null ? request.getAttribute(GrailsApplicationAttributes.CONTENT_FORMAT).toString() : null;
  String gspView=localPrefix + viewName + DOT+ format+ GSP_SUFFIX;
  Resource res=null;
  if (format != null) {
    res=loader.getResource(gspView);
    if (!res.exists()) {
      View v=lookupBinaryPluginView(webRequest,controller,gspView);
      if (v != null) {
        return v;
      }
 else {
        gspView=resolveViewForController(controller,grailsApplication,viewName,loader);
        res=loader.getResource(gspView);
      }
    }
  }
  if (res == null || !res.exists()) {
    gspView=localPrefix + viewName + GSP_SUFFIX;
    res=loader.getResource(gspView);
    if (!res.exists()) {
      View v=lookupBinaryPluginView(webRequest,controller,gspView);
      if (v != null) {
        return v;
      }
 else {
        gspView=resolveViewForController(controller,grailsApplication,viewName,loader);
        res=loader.getResource(gspView);
      }
    }
  }
  if (res.exists()) {
    return createGroovyPageView(webRequest,gspView);
  }
  AbstractUrlBasedView view=buildView(viewName);
  view.setApplicationContext(getApplicationContext());
  view.afterPropertiesSet();
  return view;
}
