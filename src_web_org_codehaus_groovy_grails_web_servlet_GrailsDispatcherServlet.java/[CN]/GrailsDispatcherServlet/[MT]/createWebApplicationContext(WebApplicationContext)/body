{
  WebApplicationContext wac=WebApplicationContextUtils.getWebApplicationContext(getServletContext());
  WebApplicationContext webContext;
  GrailsApplication application=(GrailsApplication)parent.getBean(GrailsApplication.APPLICATION_ID,GrailsApplication.class);
  if (wac instanceof GrailsWebApplicationContext) {
    webContext=wac;
  }
 else {
    GrailsRuntimeConfigurator configurator=new GrailsRuntimeConfigurator(application,parent);
    if (parent.containsBean(GrailsPluginManager.BEAN_NAME)) {
      configurator.setPluginManager((GrailsPluginManager)parent.getBean(GrailsPluginManager.BEAN_NAME));
    }
    webContext=configurator.configure(super.getServletContext());
  }
  getServletContext().setAttribute(GrailsApplicationAttributes.PARENT_APPLICATION_CONTEXT,parent);
  getServletContext().setAttribute(GrailsApplicationAttributes.APPLICATION_CONTEXT,webContext);
  getServletContext().setAttribute(GrailsApplication.APPLICATION_ID,application);
  GrailsConfigUtils.configureScaffolders(application,webContext);
  GrailsConfigUtils.executeGrailsBootstraps(application,webContext,getServletContext());
  return webContext;
}
