{
  GroovyClassLoader gcl=new GroovyClassLoader();
  gcl.parseClass("class ApplicationDataSource { String url = \"jdbc:hsqldb:mem:testDB\"; String driverClassName = \"org.hsqldb.jdbcDriver\" ;String username = \"sa\";String password = \"\"}");
  GrailsApplication app=new DefaultGrailsApplication(gcl.getLoadedClasses(),gcl);
  MockApplicationContext parent=new MockApplicationContext();
  parent.registerMockBean(GrailsApplication.APPLICATION_ID,app);
  parent.registerMockBean(PluginMetaManager.BEAN_ID,new DefaultPluginMetaManager(new Resource[0]));
  GrailsRuntimeConfigurator conf=new GrailsRuntimeConfigurator(app,parent);
  GrailsApplicationContext ctx=(GrailsApplicationContext)conf.configure(new MockServletContext());
  assertNotNull(ctx);
  Class service=gcl.parseClass("class TestService { boolean transactional = false;def serviceMethod() { 'hello' } }");
  GrailsServiceClass serviceClass=(GrailsServiceClass)app.addArtefact(ServiceArtefactHandler.TYPE,service);
  conf.registerService(serviceClass,ctx);
  assertTrue(ctx.containsBean("TestServiceClass"));
  GroovyObject serviceInstance=(GroovyObject)ctx.getBean("testService");
  assertEquals("hello",serviceInstance.invokeMethod("serviceMethod",null));
}
