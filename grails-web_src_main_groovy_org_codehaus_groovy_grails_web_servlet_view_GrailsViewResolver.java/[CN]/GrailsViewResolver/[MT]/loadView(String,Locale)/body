{
  Assert.notNull(templateEngine,"Property [templateEngine] cannot be null");
  if (viewName.endsWith(GSP_SUFFIX)) {
    viewName=viewName.substring(0,viewName.length() - GSP_SUFFIX.length());
  }
  if (developmentMode) {
    return createGrailsView(viewName);
  }
  String viewCacheKey=GrailsConventionGroovyPageLocator.resolveViewFormat(viewName);
  CacheEntry<View> entry=VIEW_CACHE.get(viewCacheKey);
  final String lookupViewName=viewName;
  PrivilegedAction<View> updater=new PrivilegedAction<View>(){
    public View run(){
      try {
        return createGrailsView(lookupViewName);
      }
 catch (      Exception e) {
        throw new WrappedInitializationException(e);
      }
    }
  }
;
  View view=null;
  if (entry == null) {
    try {
      view=updater.run();
    }
 catch (    WrappedInitializationException e) {
      e.rethrow();
    }
    entry=new CacheEntry<View>(view);
    VIEW_CACHE.put(viewCacheKey,entry);
    return view;
  }
  try {
    view=entry.getValue(cacheTimeout,updater);
  }
 catch (  WrappedInitializationException e) {
    e.rethrow();
  }
  return view;
}
