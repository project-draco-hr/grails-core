{
  ServletContext servletContext=ctx instanceof WebApplicationContext && ((WebApplicationContext)ctx).getServletContext() != null ? ((WebApplicationContext)ctx).getServletContext() : request.getServletContext();
  GrailsWebRequest webRequest=new GrailsWebRequest(request,response,servletContext,ctx);
  request.setAttribute(GrailsApplicationAttributes.WEB_REQUEST,webRequest);
  for (  ParameterCreationListener listener : ctx.getBeansOfType(ParameterCreationListener.class).values()) {
    webRequest.addParameterListener(listener);
  }
  RequestContextHolder.setRequestAttributes(webRequest);
  return webRequest;
}
