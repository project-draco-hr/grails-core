{
  PersistentClass associatedClass=null;
  if (LOG.isDebugEnabled())   LOG.debug("Mapping collection: " + collection.getRole() + " -> "+ collection.getCollectionTable().getName());
  if (collection.isOneToMany()) {
    OneToMany oneToMany=(OneToMany)collection.getElement();
    String associatedClassName=oneToMany.getReferencedEntityName();
    associatedClass=(PersistentClass)persistentClasses.get(associatedClassName);
    if (associatedClass == null) {
      throw new MappingException("Association references unmapped class: " + oneToMany.getReferencedEntityName());
    }
    oneToMany.setAssociatedClass(associatedClass);
    if (!property.isManyToMany())     collection.setCollectionTable(associatedClass.getTable());
    collection.setLazy(true);
    if (isSorted(property)) {
      collection.setSorted(true);
    }
  }
  DependantValue key=createPrimaryKeyValue(property,collection,persistentClasses);
  if (property.isBidirectional()) {
    GrailsDomainClassProperty otherSide=property.getOtherSide();
    if (otherSide.isManyToOne()) {
      linkBidirectionalOneToMany(collection,associatedClass,key,otherSide);
    }
 else     if (property.isManyToMany()) {
      bindDependentKeyValue(property,key,mappings);
    }
  }
 else {
    bindDependentKeyValue(property,key,mappings);
  }
  collection.setKey(key);
  if (property.isManyToMany()) {
    GrailsDomainClassProperty otherSide=property.getOtherSide();
    if (property.isBidirectional()) {
      if (LOG.isDebugEnabled())       LOG.debug("[GrailsDomainBinder] Mapping other side " + otherSide.getDomainClass().getName() + "."+ otherSide.getName()+ " -> "+ collection.getCollectionTable().getName()+ " as ManyToOne");
      ManyToOne element=new ManyToOne(collection.getCollectionTable());
      bindManyToMany(otherSide,element,mappings);
      collection.setElement(element);
    }
 else {
    }
  }
 else   if (isUnidirectionalOneToMany(property)) {
    bindUnidirectionalOneToMany(property,mappings,collection);
  }
}
