{
  if (attributes.getTopWriter() == null) {
    attributes=new OutputEncodingStackAttributes.Builder(attributes).topWriter(lookupRequestWriter(attributes.getWebRequest())).build();
  }
  OutputEncodingStack instance=new OutputEncodingStack(attributes);
  attributes.getWebRequest().setAttribute(ATTRIBUTE_NAME_OUTPUT_STACK,instance,RequestAttributes.SCOPE_REQUEST);
  return instance;
}
