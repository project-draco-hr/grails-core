{
  GroovyClassLoader gcl=new GroovyClassLoader();
  gcl.parseClass("class TestController {\n" + "@Property list = {\n" + "}\n"+ "}\n"+ "class FirstTagLib {\n"+ "@Property firstTag = { attrs ->\n"+ "attrs.remove('test')"+ "}\n"+ "}\n"+ "class SecondTagLib {\n"+ "@Property secondTag = { attrs ->\n"+ "firstTag(attrs)\n"+ "}\n"+ "}");
  GrailsApplicationAttributes attrs=getAttributesForClasses(gcl.getLoadedClasses(),gcl);
  assertNotNull(attrs);
  assertNotNull(attrs.getApplicationContext());
  assertNotNull(attrs.getGrailsApplication());
  MockHttpServletRequest request=new MockHttpServletRequest();
  GroovyObject controller=(GroovyObject)attrs.getApplicationContext().getBean("TestController");
  SimpleGrailsControllerHelper helper=new SimpleGrailsControllerHelper(attrs.getGrailsApplication(),attrs.getApplicationContext(),attrs.getServletContext());
  new ControllerDynamicMethods(controller,helper,request,null);
  request.setAttribute(GrailsApplicationAttributes.CONTROLLER,controller);
  GroovyObject tagLib2=attrs.getTagLibraryForTag(request,"secondTag");
  assertNotNull(tagLib2);
  Closure secondTag=(Closure)tagLib2.getProperty("secondTag");
  Map tagAttrs=new HashMap();
  tagAttrs.put("test","test");
  secondTag.call(new Object[]{tagAttrs});
  assertFalse(tagAttrs.containsKey("test"));
}
