{
  GrailsWebRequest grailsWebRequest=GrailsWebRequest.lookup(req);
  binding.setVariable(GroovyPage.WEB_REQUEST,grailsWebRequest);
  binding.setVariable(GroovyPage.REQUEST,req);
  binding.setVariable(GroovyPage.RESPONSE,res);
  binding.setVariable(GroovyPage.FLASH,grailsWebRequest.getFlashScope());
  binding.setVariable(GroovyPage.SERVLET_CONTEXT,context);
  ApplicationContext appCtx=grailsWebRequest.getAttributes().getApplicationContext();
  binding.setVariable(GroovyPage.APPLICATION_CONTEXT,appCtx);
  if (appCtx != null) {
    GrailsApplication app=appCtx.getBean(GrailsApplication.APPLICATION_ID,GrailsApplication.class);
    binding.setVariable(GrailsApplication.APPLICATION_ID,app);
    Map<String,Class<?>> domainClassesWithoutPackage=getDomainClassMap(app);
    binding.getVariables().putAll(domainClassesWithoutPackage);
  }
  binding.setVariable(GroovyPage.SESSION,grailsWebRequest.getSession());
  binding.setVariable(GroovyPage.PARAMS,grailsWebRequest.getParams());
  binding.setVariable(GroovyPage.ACTION_NAME,grailsWebRequest.getActionName());
  binding.setVariable(GroovyPage.CONTROLLER_NAME,grailsWebRequest.getControllerName());
  if (controller != null) {
    binding.setVariable(GrailsApplicationAttributes.CONTROLLER,controller);
  }
  binding.setVariable(GroovyPage.OUT,out);
}
