{
  if (application != null && application.isWarDeployed()) {
    if (application != null) {
      GroovyClassLoader classLoader=application.getClassLoader();
      MetaClassRegistry metaClassRegistry=GroovySystem.getMetaClassRegistry();
      Class[] loadedClasses=classLoader.getLoadedClasses();
      for (      Class loadedClass : loadedClasses) {
        metaClassRegistry.removeMetaClass(loadedClass);
      }
    }
    GrailsPluginManager pluginManager=PluginManagerHolder.getPluginManager();
    if (pluginManager != null) {
      try {
        pluginManager.shutdown();
      }
 catch (      Exception e) {
        GrailsUtil.sanitize(e);
        LOG.error("Error occurred shutting down plug-in manager: " + e.getMessage(),e);
      }
    }
    WebApplicationContext ctx=WebApplicationContextUtils.getWebApplicationContext(servletContext);
    ConfigurableApplicationContext parent=ctx != null ? (ConfigurableApplicationContext)ctx.getParent() : null;
    super.closeWebApplicationContext(servletContext);
    if (parent != null) {
      LOG.info("Destroying Spring parent WebApplicationContext " + parent.getDisplayName());
      parent.close();
    }
    try {
      Thread.currentThread().setContextClassLoader(getClass().getClassLoader());
    }
 catch (    java.security.AccessControlException e) {
    }
    ApplicationHolder.setApplication(null);
    ServletContextHolder.setServletContext(null);
    PluginManagerHolder.setPluginManager(null);
    ConfigurationHolder.setConfig(null);
    ExpandoMetaClass.disableGlobally();
    application=null;
  }
}
