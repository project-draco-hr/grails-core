{
  ServletContext servletContext=getServletContext();
  WebApplicationContext wac=WebApplicationContextUtils.getWebApplicationContext(servletContext);
  Assert.notNull(parent,"Grails requires a parent ApplicationContext, is the /WEB-INF/applicationContext.xml file missing?");
  setApplication(parent.getBean(GrailsApplication.APPLICATION_ID,GrailsApplication.class));
  Holders.setServletContext(servletContext);
  Holders.addApplicationDiscoveryStrategy(new ServletEnvironmentGrailsApplicationDiscoveryStrategy(servletContext));
  WebApplicationContext webContext;
  if (wac instanceof GrailsApplicationContext) {
    webContext=wac;
  }
 else {
    webContext=GrailsConfigUtils.configureWebApplicationContext(servletContext,parent);
    try {
      GrailsConfigUtils.executeGrailsBootstraps(application,webContext,servletContext);
    }
 catch (    Exception e) {
      if (e instanceof BeansException) {
        throw (BeansException)e;
      }
      throw new BootstrapException("Error executing bootstraps",e);
    }
  }
  if (webContext instanceof ConfigurableWebApplicationContext) {
    ConfigurableWebApplicationContext configurableContext=(ConfigurableWebApplicationContext)webContext;
    postProcessWebApplicationContext(configurableContext);
    applyInitializers(configurableContext);
  }
  interceptors=establishInterceptors(webContext);
  return webContext;
}
